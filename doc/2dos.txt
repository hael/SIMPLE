# MUSTDOS

exception handling class that makes more sensible outputs when running the code in distributed mode

when automsk is turned on in 2D we must force the next round to search all refs, or it will go to shit

STRATEGY 4 DISTR_SIMPLE:
    * new program: simple_exec_specify -> generate specification for parallel execution
    * sleep function is in gfortran: call sleep(nsecs)
      do while ( .not. all(job_finished) )
          call sleep(SHORT_TIME)
      end do
    * all other programs can be executed via commanders, write programs:
      simple_distr_preproc (needs CTF fitting)
      simple_distr_prime2D
      simple_distr_prime3D
      
      as a start. 4 2D case:
      exec_assemble_cavgs -> xassemble_cavgs
      exec_check2D_conv   -> xcheck2D_conv
      exec_merge_algndocs -> xmerge_algndocs
      
      need to make sure that they can communicate output via optional output object???

      implement in Fortran:
      cleanup
      get_find -> simple_math :: calc_fourier_index
      get_lp   -> simple_math :: calc_lowpass_lim
      
      * .env files as contol structure for installation & distr_simple.pl execution (COORDINATE WITH FRED)

    * cmdline 2 cmdstr function
    * implement chunk-based parallelisation

mailx -s "mail from prime2D" hans.elmlund@monash.edu < from_prime2D

* define testing environment

* UNBLUR: finish the motion correction on GPU, the expanded FT bugs out, 
  also consider subtracting the image currently being aligned
* evaluate stochastic momentum on the corr level (Cyril)
* evaluate deterministic momentum on the rec level (Cyril)
* make the Wiener filter work for initial model generation from particles in PRIME3D (BEING TESTED)

* Implement simple_finalize_recvol: lowpass based on 3Dpssnr, mask, automask, bfac (AFTER CODE TESTING) should be simple_postproc module
* test so that we can run PRIME2D/PRIME3D in all CTF/refine/eo modes (ONGOING)

# 2CONSIDER
* online prime2D
* Juha's code
* implementing the same resolution update scheme for prime2D as is in unblur

# IDEAS
* patch valiadtion to assess anisotropic motion and correction by fitting spline polinomials in Fourier phase space, i.e. an individual x,y for every Fourier component constrained by the smoothness of the bicubic splines.

# BIG PRIORITY PROJECTS
* ctffind part of unblur (be inspired by CTFFIND)
* continuous refinement (consider a multi-start continuous optimisation strategy)
* automodes for workflows

RELATED 2 FRONT-END
* check so that all programs deletes relevant files before exec
* refs should be included in the mixed formats check
* add rejected dir to simple_select
* nptcls sometimes nonsensical
* every time we execute simple, append the command line to a simple.log file with a time-stamp DELEGATE
* nthr/mem needs to be hardcoded to 1/500 for those programs that do not benefit from OpenMP
* if there's already one distr_simple.pl running in the cwd drop out DELEGATE
* when nr of commands are not sufficient the error message should tell what is missing
* sort the cleanup for all modes of distr_simple.pl exec (i.e. when similarities have been merged, remove the subfiles)
* check that all stack part are there in parallel execution (in params class) and that nptcls is correct
* when eo=yes is set the program should ask for fsc-file if missing & instruct better
* print current time in distr_simple.pl output
* implement support for different modes of exection (comlin vs. prime) without having to modify user_input.pm
* strategy for multi-user environments?
  
  simple.config: 
  
  # project info
  projectname = ribo_hael
  
  # user e-mail
  email = myname@uni.edu
  
  # electron microscope info
  acceleration_voltage = 300
  spherical_aberration_constant = 2.7
  
  # image info
  frac_amp_contrast = 0.07
  sampling_distance = 1.1
  mask_radius_pixels = 50
  
  # computing info
  no_parts = 20
  no_threads_per_part = 8
  ram_per_par = 8000
  time_per_image = 150

# RELATED 2 BACK-END
* read statements must have aX descriptor for strings
* implement the powell_frealign optimizer (from conjugate_gradients.f90 in Frealix)
* fix doc in every class DELEGATE
* variable initialization must be looked over (but don't touch the simple_opt_subs class, because OASIS bails)
* port the code to ifort DELEGATE

# RELATED 2 SCIENCE
* how about moving average strategy on the reconstruction level (applicable to all modes) DISCUSS
* Implement Niko's weighting scheme DELEGATE
* implement Richard's tilt test DELEGATE
* How can we automate good/bad particle selection? DISCUSS
* movie alignment validation on the particle level DELEGATE
* can we use OASIS for multi-start search simply by expanding the dimensions and summing up the corrs? DISCUSS
* when continuous search completed, consider combining discrete+continuous in a clever way and consider using different optimisers because they search differently (random selection criterium)
* SAXS like starting model (rotationally averaged power spec) DELEGATE
* evidence accumulation for the heterogeneity problem? DELEGATE
* In PRIME2D, why not consider making initial groupings based on ACF and use cyrils within cluster code for fixing the alignment in the end DELEGATE
* beam-induced motion: we can define neighbours in both time and space instead of averaging look back and ahead as well as in the two-dimensional surrounding, define a 3-dimensional isotropic Gaussian function for time/space weighting DISCUSS
* consider doing something even simpler for refinement: (1) sample N_sample times, (2) include the N_weights best ones regardless of whether they improve the goal function, two modes of samping: (a) random (b) guided random

# BOOKS ETC.
* Deep Learning: A Practitioner's Approach,  Adam Gibson, Josh Patterson
* Fundamentals of Deep Learning: Designing Next-Generation Machine Intelligence Algorithms, Nikhil Buduma
* Structured parallel programming
* Structure and Interpretation of Computer Programs
* J-P Morrison. Flow-Based Programming: A New Approach to Application Developments. CreateSpace, 2nd ed.
* Mathematical Foundations of Imaging, Tomography and Wavefield Inversion
* Geometric Algebra for Computer Science (Revised Edition): An Object-Oriented Approach to Geometry (The Morgan Kaufmann Series in Computer Graphics) 1st Edition
* The Princeton Companion to Applied Mathematics
* Practical Machine Learning: http://www.computervisionmodels.com/
* Applied Stochastic Modelling, Second Edition (Chapman & Hall/CRC Texts in Statistical Science) 2nd Edition http://szeliski.org/Book/