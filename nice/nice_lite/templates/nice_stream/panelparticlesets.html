{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'nice_lite/nice_lite.css' %}">
    <script src={% static 'nice_stream/panelparticlesets.js' %}></script>
</head>
<body class="w-full h-screen bg-nice4bubble text-nice4dark overflow-hidden">
    <div id="loadinggauze" class="absolute text-[10px] flex h-full w-full bg-nice4bubble top-[20px] items-center justify-center transition-opacity duration-300 delay-300 ease-in-out z-1">loading ...</div>
    {% if "particle_sets" not in jobstats or jobstats.particle_sets|length == 0 %}
        <div id="waitinggauze" class="absolute text-[10px] flex h-full w-full bg-nice4bubble top-[20px] items-center justify-center transition-opacity duration-300 delay-300 ease-in-out">no particle sets generated</div>
    {% endif %}
    <div id="help" class="hidden absolute text-[10px] flex flex-col h-full w-full bg-nice4bubble top-[20px] transition-opacity duration-300 delay-300 ease-in-out">
        <div class="flex flex-row text-nice4header ">
            <div class="cursor-pointer" onclick="document.querySelector('#help').classList.toggle('hidden')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
                    <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8Zm10.25.75a.75.75 0 0 0 0-1.5H6.56l1.22-1.22a.75.75 0 0 0-1.06-1.06l-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L6.56 8.75h4.69Z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="font-bold pl-[5px]">tips</div>
        </div>
        <div class="p-[10px]">
            some help text
        </div>
    </div>
    <div class="h-full flex-col flex justify-between">
        <div class="flex flex-row justify-end items-center">
            <div class="flex-1 font-bold text-[12px]">particle sets</div>
            <button class="h-[16px] w-[16px] text-nice4header cursor-pointer" onclick="document.querySelector('#help').classList.toggle('hidden')" title="view tip">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
                    <path fill-rule="evenodd" d="M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0Zm-6 3.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM7.293 5.293a1 1 0 1 1 .99 1.667c-.459.134-1.033.566-1.033 1.29v.25a.75.75 0 1 0 1.5 0v-.115a2.5 2.5 0 1 0-2.518-4.153.75.75 0 1 0 1.061 1.06Z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <div class="flex flex-col flex-1 overflow-y-scroll text-[10px]">
            {% for particle_set in jobstats.particle_sets %}
                <div class="flex flex-row m-[5px] border-nice4header border-[1px] rounded p-[2px]">
                    <div class="flex items-center justify-center {% if "ctime" in particle_set %}text-nice4success{% else %}text-nice4header{% endif %} scale-80">
                        {% if particle_set.type == "snapshot" %}
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                                <path d="M12 9a3.75 3.75 0 1 0 0 7.5A3.75 3.75 0 0 0 12 9Z" />
                                <path fill-rule="evenodd" d="M9.344 3.071a49.52 49.52 0 0 1 5.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 0 0 1.11-.71l.822-1.315a2.942 2.942 0 0 1 2.332-1.39ZM6.75 12.75a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Zm12-1.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                            </svg>
                        {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                                <path fill-rule="evenodd" d="M3 6a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3V6ZM3 15.75a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-2.25Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3v-2.25Z" clip-rule="evenodd" />
                            </svg>
                        {% endif %}
                    </div>
                    <div class="flex flex-1 flex-col">
                        <div class="flex flex-row">
                            <div class="flex-1 font-bold">
                                {{ particle_set.name }}
                            </div>
                            {% if "ctime" in particle_set %}
                                <div>{{ particle_set.ctime }}</div>
                            {% else %}
                                <div>running</div>
                            {% endif %}
                        </div>
                        <div class="flex flex-row">
                            <div class="flex flex-1">                        
                                {% if "nptcls" in particle_set %}
                                    <div class="mx-[5px]">particles : {{ particle_set.nptcls|intcomma }}</div>
                                {% endif %}
                                {% if "type" in particle_set %}
                                    <div class="mx-[5px]">type : {{ particle_set.type }}</div>
                                {% endif %}
                            </div>
                            <div class="flex flex-row">
                                {% if "ctime" in particle_set %}
                                    <div title="link to workspace" class="h-[16px] w-[16px] scale-75 text-nice4header cursor-pointer">
                                        {% if "filename" in particle_set and "id" in particle_set %}
                                            <form method="POST" action={% url 'nice_lite:link_stream_particle_set' jobid particle_set.id particle_set.filename particle_set.type %} target="_top">
                                                {% csrf_token %}
                                                <select class="linkbutton" name="link_workspace_id" oninput="linkParticleSet(this)">
                                                    <option selected></option>
                                                    {% for workspace in workspaces %}
                                                        <option value={{ workspace.id }}>
                                                            {{ workspace.name }}
                                                        </option>
                                                    {% endfor %}
                                                </select>
                                            </form>
                                        {% endif %}
                                    </div>
                                    <div title="copy path to starfile to clipboard" class="h-[16px] w-[16px] scale-75 text-nice4header cursor-pointer">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
                                            <path fill-rule="evenodd" d="M10.986 3H12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h1.014A2.25 2.25 0 0 1 7.25 1h1.5a2.25 2.25 0 0 1 2.236 2ZM9.5 4v-.75a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75V4h3Z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>