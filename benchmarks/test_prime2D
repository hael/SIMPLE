#!/bin/bash
if [ -z "${SIMPLE_TESTBENCH_DATA+set}" ]; then
   echo "SIMPLE_TESTBENCH_DATA env variable is not set."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}" ]; then
    echo "SIMPLE_TESTBENCH_DATA variable is not a directory."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}/bgal" ]; then
    echo "recvol_1wcm is not a directory in the benchmark data folder."; exit 1
fi

cd ${SIMPLE_TESTBENCH_DATA}/betagal
echo " ## Running PRIME2D TESTBENCH on betagal                                          "
echo " ## Expected Completion Output: 10 cores Intel Xeon E5-2650, Compiled with GNU_RELEASE_FFTW  "
echo " ##
 **** SIMPLE_CLUSTER2D NORMAL STOP ****

real	10m5.721s
user	1m26.475s
sys	0m1.997s"
SECONDS=0
[ -d betagal_prime2D_bench ] && rm -rf betagal_prime2D_bench
# mkdir prime2D_bench && cd prime2D_bench
simple_exec prg=new_project projname=betagal_prime2D_bench
if [ ! -d betagal_prime2D_bench ];then
    echo ' simple_exec prg=new_project  FAILED!!!'
    exit 1
else
    cd betagal_prime2D_bench
    simple_exec prg=import_particles ctf=yes smpd=1.275 cs=2.7 deftab=../extract_params.txt fraca=0.1 kv=300 stk=../sumstack.mrc
    #nice simple_exec prg=import_particles ctf=yes smpd=1.275 cs=2.7 kv=300 fraca=0.1 deftab=../extract_params.txt stk=../sumstack.mrc projfile=betagal.simple
    #time nice simple_distr_exec prg=cluster2D projfile=betagal.simple nparts=2 nthr=10 ncls=50 msk=88
    time simple_distr_exec prg=cluster2D ncls=100 msk=88 nparts=2 nthr=10
fi
#nohup simple_distr_exec prg=prime2D stk=../sumstack.mrc smpd=1.275 msk=88 ncls=100 ctf=yes nparts=4 nthr=8 deftab=../extract_params.txt > PRIME2D &
# BGAL
## valgrind --tool=cachegrind simple_exec  prg=prime2D stk=../sumstack.mrc smpd=1.275 msk=88 ncls=100 ctf=yes nparts=4 nthr=8 deftab=../extract_params.txt
duration=$SECONDS
echo "$(($duration / 60)) minutes and $(($duration % 60)) seconds elapsed."
