# Makefile_macros for the g95 fortran compiler.

####### The project path #####

PhysSim_source=/home/Frederic-PC.linux64/SourceCode/PhysSim

####### The switches #####

DLIB = -DCUDA
#DLIB = -DMKL
DMAGMA = -DMAGMA

####### The compilers paths #####

CCCOMP=/usr/bin/cc
GCC=/usr/bin/gcc
GFORTRAN=/usr/bin/gfortran

####### The CUDA and MAGMA paths #####

CUDADIR=/usr/local/cuda
#CUDADIR=/local/fbonnet/cudatoolkit/cuda

MAGMADIR=/usr/local/magma
MAGMADIR_CONTROL=$(MAGMADIR)/control
MAGMADIR_INCLUDE=$(MAGMADIR)/include

####### Set MAGMA-ADDONS={Magma version} to compile Magma addons. #####

MAGMA-ADDONS=1.0
GPU_MODEL=0.0     #0: tesla arch, 1: fermi arch 

####### Modules and objects directories. #####

OBJDIR=obj/GFORTgpu
MODDIR=obj/GFORTgpu

##############
# C compiler.#
##############

CC=$(CCCOMP)
CFLAGS= -O3 -O -DADD_ -DBENCH $(DLIB)
CCLIB=$(CC) -c $(CFLAGS) -I $(MODDIR)                                                            \
                         -I $(PhysSim_source)/gpu

################
# C++ compiler.#
################

CPP=$(GCC)
CPPFLAGS= -O3 -DADD_ $(DMAGMA) $(DLIB)
CPPCLIB=$(CPP) -c $(CPPFLAGS) -I $(MODDIR)                                                             \
                              -I $(PhysSim_source)/testCode

#################
# CUDA compiler.#
#################

ifeq ($(GCC),/usr/bin/gcc-4.4)
	COMPILATIONBIND= $(PhysSim_source)/trunk/modules/gcc-4.4
else
        COMPILATIONBIND=gcc
endif

#ifeq ($(GPU_MODEL),0.0)
#	PUSHMEM_GPU= -arch sm_13 -DGPUSHMEM=130 -gencode arch=compute_13,code=compute_13 -gencode arch=compute_10,code=compute_10
#else
        PUSHMEM_GPU= -arch sm_20 -DGPUSHMEM=200 -gencode arch=compute_20,code=compute_20
#endif


NVCC=$(CUDADIR)/bin/nvcc
NVCCFLAGS= --ptxas-options=-v --compiler-bindir $(COMPILATIONBIND) --compiler-options -fno-strict-aliasing $(PUSHMEM_GPU) -DUNIX -O3 -DADD_ -DCUDA
NVCCCLIB=$(NVCC) -c $(NVCCFLAGS) -I $(MODDIR)                               \
                                 -I $(CUDADIR)/include                      \
                                 -I $(MAGMADIR_INCLUDE)                     \
                                 -I $(MAGMADIR_CONTROL)

#######################
# Fortran 77 compiler.#
#######################

F77C=$(GFORTRAN)
F77FLAGS=-O3 -cpp
F77CLIB=$(F77C) -c $(F77FLAGS)

#######################
# Fortran 90 compiler.#
#######################

# $(DLIB)
F90C=$(GFORTRAN)
F90FLAGS=-ffree-form -cpp -O3  -fno-second-underscore  -DBENCH $(DMAGMA) $(DLIB)
F90FLAGS77=-ffixed-form -cpp -O3 -fPIC -fno-second-underscore -DBENCH $(DMAGMA) $(DLIB)
F90CLIB=$(F90C) -c $(F90FLAGS) -I .                        \
                               -I $(MODDIR)                \
                               -J $(MODDIR)


F90CLIB77=$(F90C) -c $(F90FLAGS77) -I .                        \
                                   -I $(MODDIR)                \
                                   -J $(MODDIR)

F90POST=
