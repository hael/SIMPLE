#!/bin/bash
if [ -z "${SIMPLE_TESTBENCH_DATA+set}" ]; then
   echo "SIMPLE_TESTBENCH_DATA env variable is not set."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}" ]; then
    echo "SIMPLE_TESTBENCH_DATA variable is not a directory."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}/bgal" ]; then
    echo "recvol_1wcm is not a directory in the benchmark data folder."; exit 1
fi

cd ${SIMPLE_TESTBENCH_DATA}/bgal
prime_cleanup.pl
pkill simple_exec
[ -d prime3Dinit_bench ] && rm -rf prime3Dinit_bench
mkdir prime3Dinit_bench && cd prime3Dinit_bench

#time simple_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
simple_private_exec prg=import_cavgs   stk=../cavgs_final.mrc smpd=2.55 projfile=init3Dtest.simple projname=init3Dtest
nohup simple_distr_exec prg=initial_3Dmodel  projfile=init3Dtest.simple smpd=1.5 msk=50 ctf=no pgrp=c1 stk=../cavgs_final.mrc
## valgrind --tool=cachegrind  simple_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
## valgrind --tool=memgrind  simple_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
