#!/bin/bash
if [ -z "${SIMPLE_TESTBENCH_DATA+set}" ]; then
   echo "SIMPLE_TESTBENCH_DATA env variable is not set."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}" ]; then
    echo "SIMPLE_TESTBENCH_DATA variable is not a directory."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}/bgal" ]; then
    echo "recvol_1wcm is not a directory in the benchmark data folder."; exit 1
fi
SECONDS=0
cd ${SIMPLE_TESTBENCH_DATA}/bgal

[ -d prime3Dinit_bench ] && rm -rf prime3Dinit_bench
simple_exec prg=new_project projname=prime3Dinit_bench
if [ ! -d prime3Dinit_bench ];then
    echo ' simple_exec prg=new_project  FAILED!!!'
    exit 1
else
    cd prime3Dinit_bench
#time simple_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
nice simple_exec prg=import_cavgs   stk=../cavgs_final_ranked.mrc  smpd=1.5 msk=50 ctf=no pgrp=c1
time simple_distr_exec prg=initial_3Dmodel  nthr=10 nparts=2 msk=50 ctf=no pgrp=c1 eo=no

## valgrind --tool=cachegrind  simple_distr_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
## valgrind --tool=memgrind  simple_distr_exec prg=prime3D_init stk=../cavgs_final.mrc smpd=1.5 msk=50 ctf=no pgrp=c1
duration=$SECONDS
echo "$(($duration / 60)) minutes and $(($duration % 60)) seconds elapsed."
