var LiteMol;(function(e){var r;(function(e){e.VERSION={number:"1.6.5",date:"Feb 8 2018"}})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(t){var a=e.Bootstrap;var o=a.Entity;t.DownloadMolecule=o.Transformer.Molecule.downloadMoleculeSource({sourceId:"url-molecule",name:"URL",description:"Download a molecule from the specified Url (if the host server supports cross domain requests).",defaultId:"https://webchem.ncbr.muni.cz/CoordinateServer/1tqn/cartoon",urlTemplate:function(e){return e},isFullUrl:true});t.ObtainDownloadSources=["CoordinateServer","PDBe Updated mmCIF","URL","File on Disk"];t.ObtainMolecule=a.Tree.Transformer.action({id:"viewer-obtain-molecule",name:"Molecule",description:"Download or open a molecule from various sources.",from:[o.Root],to:[o.Action],defaultParams:function(r){return{sourceKind:"CoordinateServer",sources:{CoordinateServer:{kind:"CoordinateServer",id:"1cbs",type:"Full",lowPrecisionCoords:true,serverUrl:r.settings.get("molecule.downloadBinaryCIFFromCoordinateServer.server")?r.settings.get("molecule.downloadBinaryCIFFromCoordinateServer.server"):"https://webchem.ncbr.muni.cz/CoordinateServer"},"PDBe Updated mmCIF":{kind:"PDBe Updated mmCIF",id:"1cbs"},URL:{kind:"URL",format:e.Core.Formats.Molecule.SupportedFormats.mmCIF,url:"https://webchem.ncbr.muni.cz/CoordinateServer/1tqn/cartoon"},"File on Disk":{kind:"File on Disk",file:void 0}}}},validateParams:function(e){var r=e.sources[e.sourceKind];switch(r.kind){case"CoordinateServer":return!r.id||!r.id.trim().length?["Enter Id"]:!r.serverUrl||!r.serverUrl.trim().length?["Enter CoordinateServer base URL"]:void 0;case"PDBe Updated mmCIF":return!r.id||!r.id.trim().length?["Enter Id"]:void 0;case"URL":return!r.url||!r.url.trim().length?["Enter URL"]:void 0;case"File on Disk":return!r.file?["Select a File"]:void 0}return void 0}},function(e,o,n){var i=n.params.sources[n.params.sourceKind];var s=a.Tree.Transform.build();switch(i.kind){case"CoordinateServer":s.add(o,r.PDBe.Data.DownloadBinaryCIFFromCoordinateServer,i);break;case"PDBe Updated mmCIF":s.add(o,r.PDBe.Data.DownloadMolecule,{id:i.id});break;case"URL":s.add(o,t.DownloadMolecule,{format:i.format,id:i.url});break;case"File on Disk":s.add(o,a.Entity.Transformer.Molecule.OpenMoleculeFromFile,{file:i.file});break}return s})})(t=r.DataSources||(r.DataSources={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var __awaiter=this&&this.__awaiter||function(e,r,t,a){return new(t||(t=Promise))(function(o,n){function i(e){try{l(a.next(e))}catch(e){n(e)}}function s(e){try{l(a["throw"](e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(i,s)}l((a=a.apply(e,r||[])).next())})};var __generator=this&&this.__generator||function(e,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},a,o,n,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(r){return l([e,r])}}function l(i){if(a)throw new TypeError("Generator is already executing.");while(t)try{if(a=1,o&&(n=o[i[0]&2?"return":i[0]?"throw":"next"])&&!(n=n.call(o,i[1])).done)return n;if(o=0,n)i=[0,n.value];switch(i[0]){case 0:case 1:n=i;break;case 4:t.label++;return{value:i[1],done:false};case 5:t.label++;o=i[1];i=[0];continue;case 7:i=t.ops.pop();t.trys.pop();continue;default:if(!(n=t.trys,n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){t=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){t.label=i[1];break}if(i[0]===6&&t.label<n[1]){t.label=n[1];n=i;break}if(n&&t.label<n[2]){t.label=n[2];t.ops.push(i);break}if(n[2])t.ops.pop();t.trys.pop();continue}i=r.call(e,t)}catch(e){i=[6,e];o=0}finally{a=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t=this;var a=e.Bootstrap.Entity;var o=e.Bootstrap.Entity.Transformer;r.Report=a.create({name:"Ligand Validation Report",typeClass:"Behaviour",shortName:"VR",description:"Represents ValidatorDB ligand validation report."});var n;(function(r){function t(e,r){var t=e.split(" ");r.authSeqNumber=+t[1];r.authAsymId=t[2]}function a(e){return e.split(" ")[0]}var o=e.Core.Utils.FastSet.ofArray(["Missing","NotAnalyzed"]);function n(e){for(var r=0,t=e;r<t.length;r++){var a=t[r];if(o.has(a))return true}return false}function i(r){var o=e.Core.Utils.FastMap.create();if(!r.Models)return o;var i={authSeqNumber:0,authAsymId:""};var s=e.Core.Utils.FastSet.create();for(var l=0,c=r.Models;l<c.length;l++){var u=c[l];for(var m=0,d=u.Entries;m<d.length;m++){var p=d[m];if(!p.MainResidue)continue;t(p.MainResidue,i);var f=o.get(i.authAsymId);if(f===void 0){f=e.Core.Utils.FastMap.create();o.set(i.authAsymId,f)}var h=[];if(p.Flags.indexOf("Missing_Atoms")>=0)h.push("Missing Atoms");if(p.Flags.indexOf("Missing_Rings")>=0)h.push("Missing Rings");if(p.Flags.indexOf("Missing_Degenerate")>=0)h.push("Degenerate");if(p.Flags.indexOf("HasAll_BadChirality")>=0)h.push("Bad Chirality");if(!h.length)h.push("No Issue");var v=void 0;var B=p.ChiralityMismatches;for(var A=0,y=Object.keys(B);A<y.length;A++){var g=y[A];if(!Object.prototype.hasOwnProperty.call(B,g))continue;var C=B[g];if(!v)v=e.Core.Utils.FastSet.create();v.add(a(C))}f.set(i.authSeqNumber,{isRed:n(p.Flags),flags:h,chiralityMismatches:v?v:s})}}return o}r.createReport=i})(n=r.Api||(r.Api={}));var i;(function(r){var t=function(){function r(e,r){var t=this;this.context=e;this.report=r;this.provider=function(e){try{return t.processInfo(e)}catch(e){console.error("Error showing validation label",e);return void 0}}}r.prototype.dispose=function(){this.context.highlight.removeProvider(this.provider)};r.prototype.register=function(e){this.context.highlight.addProvider(this.provider)};r.prototype.getChainId=function(e){var r=e.indexOf("-");if(r>0)return e.substr(0,r);return e};r.prototype.processInfo=function(r){var t=e.Bootstrap.Interactivity.Molecule.transformInteraction(r);if(!t||t.residues.length!==1)return void 0;var a=this.report;if(t.atoms.length===1){var o=t.atoms[0];var n=a.get(this.getChainId(o.residue.chain.authAsymId));var i=n?n.get(o.residue.authSeqNumber):void 0;var s=i?i.chiralityMismatches.has(o.name):false;if(!i)return void 0;return"<div><small>[Validation]</small> Atom: <b>"+(s?"Bad Chirality":"OK")+"</b>, Residue: <b>"+i.flags.join(", ")+"</b></div>"}else{var l=t.residues[0];var n=a.get(this.getChainId(l.chain.authAsymId));var i=n?n.get(l.authSeqNumber):void 0;if(!i)return void 0;return"<div><small>[Validation]</small> Residue: <b>"+i.flags.join(", ")+"</b></div>"}};return r}();r.Behaviour=t})(i=r.Interactivity||(r.Interactivity={}));var s;(function(r){var t=function(){var r=e.Core.Utils.FastMap.create();r.set(0,{r:.4,g:.4,b:.4});r.set(1,{r:0,g:1,b:0});r.set(2,{r:1,g:0,b:0});return r}();var a={r:.6,g:.6,b:.6};var o={r:0,g:0,b:1};var n={r:1,g:0,b:1};function i(e,r){var t=new Uint8Array(e.data.atoms.count);var a=e.data.residues,o=a.authAsymId,n=a.authSeqNumber,i=a.atomStartIndex,s=a.atomEndIndex;var l=e.data.atoms.authName;for(var c=0,u=e.data.residues.count;c<u;c++){var m=r.get(o[c]);if(!m)continue;var d=m.get(n[c]);if(!d)continue;var p=d.chiralityMismatches;for(var f=i[c],h=s[c];f<h;f++){if(d.isRed||p.has(l[f]))t[f]=2;else t[f]=1}}return t}function s(e,r){var t=e.parent;var a=new Uint8Array(e.data.atoms.count);var o=e.data.residues,n=o.authSeqNumber,i=o.atomStartIndex,s=o.atomEndIndex,l=o.chainIndex;var c=e.data.chains.sourceChainIndex;var u=t.data.chains.authAsymId;var m=e.data.atoms.authName;for(var d=0,p=e.data.residues.count;d<p;d++){var f=r.get(u[c[l[d]]]);if(!f)continue;var h=f.get(n[d]);if(!h)continue;var v=h.chiralityMismatches;for(var B=i[d],A=s[d];B<A;B++){if(h.isRed||v.has(m[B]))a[B]=2;else a[B]=1}}return a}function l(r,l){var c=r.props.model;var u=c.source===e.Core.Structure.Molecule.Model.Source.File?i(c,l):s(c,l);var m=e.Core.Utils.FastMap.create();m.set("Uniform",a);m.set("Selection",o);m.set("Highlight",n);var d=e.Visualization.Theme.createColorMapMapping(function(e){return u[e]},t,a);return e.Visualization.Theme.createMapping(d,{colors:m,interactive:true,transparency:{alpha:1}})}r.create=l})(s||(s={}));var l=e.Bootstrap.Tree.Transformer.create({id:"validatordb-create",name:"Ligand Validation",description:"Create the validation report from a string.",from:[a.Data.String],to:[r.Report],defaultParams:function(){return{}}},function(a,o,s){return e.Bootstrap.Task.create("ValidatorDB Report ("+s.params.id+")","Normal",function(e){return __awaiter(t,void 0,void 0,function(){var t,l;return __generator(this,function(c){switch(c.label){case 0:return[4,e.updateProgress("Parsing...")];case 1:c.sent();t=JSON.parse(o.props.data);l=n.createReport(t||{});return[2,r.Report.create(s,{label:"Ligand Validation Report",behaviour:new i.Behaviour(a,l)})]}})})}).setReportTime(true)});r.DownloadAndCreate=e.Bootstrap.Tree.Transformer.action({id:"validatordb-download-and-create",name:"Ligand Validation Report",description:"Download Validation Report from ValidatorDB",from:[a.Molecule.Molecule],to:[a.Action],defaultParams:function(){return{}}},function(r,t,a){var n=t.props.molecule.id.trim().toLocaleLowerCase();var i=e.Bootstrap.Tree.Transform.build().add(t,o.Data.Download,{url:"https://webchem.ncbr.muni.cz/Platform/ValidatorDb/Data/"+n+"?source=ByStructure",type:"String",id:n,description:"Validation Data",title:"Validation"}).then(l,{id:n},{isBinding:true,ref:a.params.reportRef});return i},"Validation report loaded. Hovering over residue will now contain validation info. To apply validation coloring, select the 'Ligand Validation Report' entity in the tree and apply it the right panel. "+"Only missing atoms/rings and chirality issues are shown, for more details please visit https://webchem.ncbr.muni.cz/Platform/ValidatorDb/Index.");r.ApplyTheme=e.Bootstrap.Tree.Transformer.create({id:"validatordb-apply-theme",name:"Apply Coloring",description:"Colors all visuals using the validation report.",from:[r.Report],to:[a.Action],defaultParams:function(){return{}}},function(r,a,o){return e.Bootstrap.Task.create("Validation Coloring","Background",function(o){return __awaiter(t,void 0,void 0,function(){var t,o,n,i,l,c,u,m;return __generator(this,function(d){t=e.Bootstrap.Tree.Node.findAncestor(a,e.Bootstrap.Entity.Molecule.Molecule);if(!t){throw"No suitable parent found."}o=e.Core.Utils.FastMap.create();n=r.select(e.Bootstrap.Tree.Selection.byValue(t).subtree().ofType(e.Bootstrap.Entity.Molecule.Visual));for(i=0,l=n;i<l.length;i++){c=l[i];u=e.Bootstrap.Utils.Molecule.findModel(c);if(!u)continue;m=o.get(u.id);if(!m){m=s.create(u,a.props.behaviour.report);o.set(u.id,m)}e.Bootstrap.Command.Visual.UpdateBasicTheme.dispatch(r,{visual:c,theme:m})}r.logger.message("Validation coloring applied.");return[2,e.Bootstrap.Tree.Node.Null]})})})})})(t=r.ValidatorDB||(r.ValidatorDB={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(e){var r;(function(e){"use strict";e.FieldSources=["X-ray","EM"];var r;(function(e){var r;(function(e){e.Float32="float32";e.Int8="int8"})(r=e.ValueType||(e.ValueType={}))})(r=e.ServerDataFormat||(e.ServerDataFormat={}))})(r=e.DensityStreaming||(e.DensityStreaming={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var __assign=this&&this.__assign||Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++){r=arguments[t];for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o))e[o]=r[o]}return e};var LiteMol;(function(e){var r;(function(r){var t;(function(r){"use strict";var t=this;var a=e.Bootstrap.Entity;var o=e.Bootstrap.Entity.Transformer;var n=e.Bootstrap.Tree;r.Streaming=a.create({name:"Interactive Surface",typeClass:"Behaviour",shortName:"B_DS",description:"Behaviour that downloads density data for molecule selection on demand."});r.CreateStreaming=n.Transformer.create({id:"density-streaming-create-streaming",name:"Density Streaming",description:"On demand download of density data when a residue or atom is selected.",from:[],to:[r.Streaming],isUpdatable:true,defaultParams:function(){return{}},customController:function(r,t,a){return new e.Bootstrap.Components.Transform.DensityVisual(r,t,a)}},function(t,a,o){var n=new r.Behaviour(t,o.params);return e.Bootstrap.Task.resolve("Behaviour","Background",r.Streaming.create(o,{label:"Density Streaming",behaviour:n}))},function(r,o,i){return e.Bootstrap.Task.create("Density","Background",function(e){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,3,4]);return[4,o.props.behaviour.invalidateParams(i.params)];case 1:r.sent();return[3,4];case 2:e=r.sent();return[3,4];case 3:a.nodeUpdated(o);return[2,n.Node.Null];case 4:return[2]}})})})});r.Setup=e.Bootstrap.Tree.Transformer.actionWithContext({id:"density-streaming-create",name:"Density Streaming",description:"On demand download of density data when a residue or atom is selected.",from:[a.Molecule.Molecule],to:[a.Action],defaultParams:function(e,r){var t="X-ray";var a=(r.props.molecule.properties.experimentMethod||"").toLowerCase();if(a.indexOf("microscopy")>=0)t="EM";return{server:e.settings.get("extensions.densityStreaming.defaultServer"),id:r.props.molecule.id,source:t}},validateParams:function(e){if(!e.server.trim().length)return["Enter Server"];return!e.id.trim().length?["Enter Id"]:void 0}},function(e,r,t){switch(t.params.source){case"X-ray":return l(r,e,t.params);case"EM":return u(r,e,t.params);default:return i(r,"Unknown data source.")}});function i(r,t){return{action:e.Bootstrap.Tree.Transform.build().add(r,o.Basic.Fail,{title:"Density Streaming",message:t}),context:void 0}}function s(t,a,o,n,i){var s="Silent";var l=a.source==="EM"?{EM:e.Bootstrap.Visualization.Density.Style.create({isoValue:i!==void 0?i:1.5,isoValueType:i!==void 0?e.Bootstrap.Visualization.Density.IsoValueType.Absolute:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(6524815),isWireframe:false,transparency:{alpha:.3},taskType:s})}:{"2Fo-Fc":e.Bootstrap.Visualization.Density.Style.create({isoValue:1.5,isoValueType:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(3367602),isWireframe:false,transparency:{alpha:.4},taskType:s}),"Fo-Fc(+ve)":e.Bootstrap.Visualization.Density.Style.create({isoValue:3,isoValueType:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(3390259),isWireframe:true,transparency:{alpha:1},taskType:s}),"Fo-Fc(-ve)":e.Bootstrap.Visualization.Density.Style.create({isoValue:-3,isoValueType:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(12268339),isWireframe:true,transparency:{alpha:1},taskType:s})};var c=__assign({maxRadius:a.source==="X-ray"?10:50,server:a.server,source:a.source,id:n?n:a.id,header:o,isoValueType:a.source==="X-ray"||i===void 0?e.Bootstrap.Visualization.Density.IsoValueType.Sigma:e.Bootstrap.Visualization.Density.IsoValueType.Absolute,isoValues:a.source==="X-ray"?{"2Fo-Fc":1.5,"Fo-Fc(+ve)":3,"Fo-Fc(-ve)":-3}:{EM:i!==void 0?i:1.5},displayType:a.source==="X-ray"?"Around Selection":"Everything",detailLevel:Math.min(2,o.availablePrecisions.length-1),radius:a.source==="X-ray"?5:15,showEverythingExtent:3},l,a.initialStreamingParams);return{action:e.Bootstrap.Tree.Transform.build().add(t,r.CreateStreaming,c,{ref:a.streamingEntityRef}),context:void 0}}function l(r,t,a,o,n){return __awaiter(this,void 0,void 0,function(){var l,c,u,m;return __generator(this,function(d){switch(d.label){case 0:l=a.server.trim();if(l[l.length-1]!=="/")l+="/";c=""+l+a.source+"/"+(o?o:a.id);return[4,e.Bootstrap.Utils.ajaxGetString(c,"DensityServer").run(t)];case 1:u=d.sent();try{m=JSON.parse(u);if(!m.isAvailable){return[2,i(r,"Density streaming is not available for '"+a.source+"/"+a.id+"'.")]}m.channels=m.channels.map(function(e){return e.toUpperCase()});return[2,s(r,a,m,o,n)]}catch(e){return[2,i(e,"DensityServer API call failed.")]}return[2]}})})}function c(r,t,a,o){return __awaiter(this,void 0,void 0,function(){var n,s,c,u,m;return __generator(this,function(d){switch(d.label){case 0:o=o.trim();return[4,e.Bootstrap.Utils.ajaxGetString("https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/"+o,"EMDB API").run(t)];case 1:n=d.sent();d.label=2;case 2:d.trys.push([2,4,,5]);s=JSON.parse(n);c=s[o];u=void 0;if(c&&c[0]&&c[0].map&&c[0].map.contour_level&&c[0].map.contour_level.value!==void 0){u=+c[0].map.contour_level.value}return[4,l(r,t,a,o,u)];case 3:return[2,d.sent()];case 4:m=d.sent();return[2,i(r,"EMDB API call failed.")];case 5:return[2]}})})}function u(r,t,a){return __awaiter(this,void 0,void 0,function(){var o,n,s,l,u,m,d;return __generator(this,function(p){switch(p.label){case 0:o=a.id.trim().toLowerCase();return[4,e.Bootstrap.Utils.ajaxGetString("https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+o,"PDB API").run(t)];case 1:n=p.sent();p.label=2;case 2:p.trys.push([2,4,,5]);s=JSON.parse(n);l=s[o];u=void 0;if(l&&l[0]&&l[0].related_structures){m=l[0].related_structures.filter(function(e){return e.resource==="EMDB"});if(!m.length){return[2,i(r,"No related EMDB entry found for '"+o+"'.")]}u=m[0].accession}else{return[2,i(r,"No related EMDB entry found for '"+o+"'.")]}return[4,c(r,t,a,u)];case 3:return[2,p.sent()];case 4:d=p.sent();return[2,i(r,"PDBe API call failed.")];case 5:return[2]}})})}})(t=r.DensityStreaming||(r.DensityStreaming={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){"use strict";var t=e.Bootstrap.Entity;var a=e.Bootstrap.Entity.Transformer;var o=e.Bootstrap.Utils;var n=e.Bootstrap.Interactivity;var i="__ShowDynamicDensity-toast";var s=function(){function s(r,t){this.context=r;this.params=t;this.obs=[];this.groups={requested:e.Core.Utils.FastSet.create(),shown:e.Core.Utils.FastSet.create(),locked:e.Core.Utils.FastSet.create(),toBeRemoved:e.Core.Utils.FastSet.create()};this.download=void 0;this.selectionBox=void 0;this.modelBoundingBox=void 0;this.channels=void 0;this.cache=e.Bootstrap.Utils.LRUCache.create(25);this.performance=new e.Core.Utils.PerformanceMonitor;this.wasCached=false;this.server=t.server;if(this.server[this.server.length-1]==="/")this.server=this.server.substr(0,this.server.length-1);if(t.source==="EM"){this.types=["EM"]}else{this.types=["2Fo-Fc","Fo-Fc(+ve)","Fo-Fc(-ve)"]}}s.prototype.areBoxesSame=function(e){if(!this.selectionBox)return false;for(var r=0;r<3;r++){if(e.a[r]!==this.selectionBox.a[r]||e.b[r]!==this.selectionBox.b[r])return false}return true};s.prototype.getModelBoundingBox=function(){if(this.modelBoundingBox)return this.modelBoundingBox;var e=o.Molecule.findMolecule(this.behaviour);var r=o.Molecule.getBox(e.props.molecule.models[0],e.props.molecule.models[0].data.atoms.indices,this.params.showEverythingExtent),t=r.bottomLeft,a=r.topRight;this.modelBoundingBox={a:t,b:a};return this.modelBoundingBox};s.prototype.stop=function(){if(this.download){this.download.tryAbort();this.download=void 0}};s.prototype.remove=function(r){for(var t=0,a=this.context.select(r);t<a.length;t++){var o=a[t];e.Bootstrap.Tree.remove(o)}this.groups.toBeRemoved.delete(r)};s.prototype.clear=function(){var e=this;this.stop();this.groups.requested.forEach(function(r){return e.groups.toBeRemoved.add(r)});this.groups.locked.forEach(function(r){return e.groups.toBeRemoved.add(r)});this.groups.shown.forEach(function(r){if(!e.groups.locked.has(r))e.remove(r)});this.groups.shown.clear();this.channels=void 0};s.prototype.groupDone=function(e,r){this.groups.requested.delete(e);if(this.groups.toBeRemoved.has(e)){this.remove(e)}else if(r){this.groups.shown.add(e)}};s.prototype.checkResult=function(e){var r=e.dataBlocks.filter(function(e){return e.header==="SERVER"})[0];if(!r)return false;var t=r.getCategory("_density_server_result");if(!t)return false;if(t.getColumn("is_empty").getString(0)==="yes"||t.getColumn("has_error").getString(0)==="yes"){return false}return true};s.prototype.apply=function(r){return e.Bootstrap.Tree.Transform.apply(this.context,r).run()};s.prototype.finish=function(){this.performance.end("query");this.context.logger.info("[Density] Streaming done in "+this.performance.formatTime("query")+(this.wasCached?" (cached)":"")+".")};s.prototype.createXray=function(){return __awaiter(this,void 0,void 0,function(){var r,t,n,i,s,l,c,u,m,d;return __generator(this,function(p){switch(p.label){case 0:p.trys.push([0,5,,6]);if(!this.channels)return[2];this.syncStyles();r=this.channels["2FO-FC"];t=this.channels["FO-FC"];n=e.Bootstrap.Tree.Transform.build();i=o.generateUUID();this.groups.requested.add(i);s=n.add(this.behaviour,a.Basic.CreateGroup,{label:"Density"},{ref:i,isHidden:true});l=this.params;s.then(a.Density.CreateFromData,{id:"2Fo-Fc",data:r},{ref:i+"2Fo-Fc-data"});s.then(a.Density.CreateFromData,{id:"Fo-Fc",data:t},{ref:i+"Fo-Fc-data"});return[4,this.apply(n)];case 1:p.sent();c=this.apply(e.Bootstrap.Tree.Transform.build().add(i+"2Fo-Fc-data",a.Density.CreateVisual,{style:l["2Fo-Fc"]},{ref:i+"2Fo-Fc"}));u=this.apply(e.Bootstrap.Tree.Transform.build().add(i+"Fo-Fc-data",a.Density.CreateVisual,{style:l["Fo-Fc(+ve)"]},{ref:i+"Fo-Fc(+ve)"}));m=this.apply(e.Bootstrap.Tree.Transform.build().add(i+"Fo-Fc-data",a.Density.CreateVisual,{style:l["Fo-Fc(-ve)"]},{ref:i+"Fo-Fc(-ve)"}));return[4,c];case 2:p.sent();return[4,u];case 3:p.sent();return[4,m];case 4:p.sent();this.finish();this.groupDone(i,true);return[3,6];case 5:d=p.sent();this.context.logger.error("[Density] "+d);return[3,6];case 6:return[2]}})})};s.prototype.createEm=function(){var r=this;try{if(!this.channels)return;this.syncStyles();var t=this.channels["EM"];var n=e.Bootstrap.Tree.Transform.build();var i=o.generateUUID();this.groups.requested.add(i);var s=this.params;n.add(this.behaviour,a.Basic.CreateGroup,{label:"Density"},{ref:i,isHidden:true}).then(a.Density.CreateFromData,{id:"EM",data:t}).then(a.Density.CreateVisual,{style:s["EM"]},{ref:i+"EM"});e.Bootstrap.Tree.Transform.apply(this.context,n).run().then(function(){r.finish();r.groupDone(i,true)}).catch(function(){return r.groupDone(i,false)})}catch(e){this.context.logger.error("[Density] "+e)}};s.prototype.extendSelectionBox=function(){var e=this.selectionBox,r=e.a,t=e.b;var a=this.params.radius;return{a:r.map(function(e){return e-a}),b:t.map(function(e){return e+a})}};s.prototype.isSameMolecule=function(e){var r=o.Molecule.findMolecule(this.behaviour);var t=o.Molecule.findMolecule(e.source);return r===t};s.getChannel=function(r,t){var a=r.dataBlocks.filter(function(e){return e.header===t})[0];if(!a){return void 0}var o=e.Core.Formats.Density.CIF.parse(a);if(o.isError)return void 0;return o.result};s.prototype.noChannels=function(){this.context.logger.warning("Density Streaming: No data.");return void 0};s.prototype.parseChannels=function(r){var t=e.Core.Formats.CIF.Binary.parse(r);if(t.isError||!this.checkResult(t.result))return this.noChannels();if(this.params.source==="EM"){var a=s.getChannel(t.result,"EM");if(!a)return this.noChannels();return{EM:a}}else{var o=s.getChannel(t.result,"2FO-FC");if(!o)return this.noChannels();var n=s.getChannel(t.result,"FO-FC");if(!n)return this.noChannels();return{"2FO-FC":o,"FO-FC":n}}};s.prototype.query=function(r){var t=this;this.clear();var a=""+this.server+("/"+this.params.source)+("/"+this.params.id);if(r){var n=r.a,i=r.b;a+="/box"+("/"+n.map(function(e){return Math.round(1e3*e)/1e3}).join(","))+("/"+i.map(function(e){return Math.round(1e3*e)/1e3}).join(","))}else{a+="/cell"}a+="?detail="+this.params.detailLevel;this.performance.start("query");var s=e.Bootstrap.Utils.LRUCache.get(this.cache,a);if(s){this.clear();this.channels=s;this.wasCached=true;if(this.params.source==="EM")this.createEm();else this.createXray();return}this.download=o.ajaxGetArrayBuffer(a,"Density").runWithContext(this.context);this.download.result.then(function(r){t.clear();t.channels=t.parseChannels(r);if(!t.channels)return;t.wasCached=false;e.Bootstrap.Utils.LRUCache.set(t.cache,a,t.channels);if(t.params.source==="EM")t.createEm();else t.createXray()})};s.prototype.tryUpdateSelectionDataBox=function(e){var r=e;if(!n.Molecule.isMoleculeModelInteractivity(e)||!this.isSameMolecule(r)){var t=this.selectionBox!==void 0;this.selectionBox=void 0;return t}var a=o.Molecule.findModel(r.source);var i=r.elements;var s=a.props.model;if(r.elements.length===1){i=o.Molecule.getResidueIndices(s,r.elements[0])}var l=o.Molecule.getBox(s,i,0),c=l.bottomLeft,u=l.topRight;var m={a:c,b:u};if(this.areBoxesSame(m)){return false}else{this.selectionBox=m;return true}};s.prototype.update=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){e.Bootstrap.Command.Toast.Hide.dispatch(this.context,{key:i});if(this.params.displayType==="Everything"){if(this.params.source==="EM"){if(this.params.forceBox)this.query(this.getModelBoundingBox());else this.query()}else{this.query(this.getModelBoundingBox())}}else{if(this.selectionBox){this.query(this.extendSelectionBox())}else{this.clear()}}return[2]})})};s.prototype.toSigma=function(e){var t=this.params.header.channels.indexOf(r.IsoInfo[e].dataKey);var a=this.params.header.sampling[0].valuesInfo[t];var o=this.params.isoValues[e];return(o-a.mean)/a.sigma};s.prototype.syncStyles=function(){var r=this.params.displayType==="Everything"?"Background":this.params.radius>15?"Background":"Silent";var t=this.params.isoValueType===e.Bootstrap.Visualization.Density.IsoValueType.Sigma;for(var a=0,o=this.types;a<o.length;a++){var n=o[a];var i=this.params[n];var s=i.params;var l=t?this.params.isoValues[n]:this.toSigma(n);this.params[n]=__assign({},i,{taskType:r,params:__assign({},s,{isoValueType:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,isoValue:l})})}};s.prototype.updateVisual=function(e,r){return t.Transformer.Density.CreateVisual.create({style:r},{ref:e.ref}).update(this.context,e).run()};s.prototype.invalidateStyles=function(){return __awaiter(this,void 0,void 0,function(){var r=this;var t,a,o,n,i,s,l,c,u,m;return __generator(this,function(d){switch(d.label){case 0:if(this.groups.shown.size===0)return[2];this.syncStyles();t=this.params;a=[];this.groups.shown.forEach(function(e){a.push(e);r.groups.locked.add(e)});o=function(r){var o,i,s,l,c,u;return __generator(this,function(m){switch(m.label){case 0:o=t[r];if(!o)return[2,"continue"];i=n.context.select((u=e.Bootstrap.Tree.Selection).byRef.apply(u,a.map(function(e){return e+r})));s=0,l=i;m.label=1;case 1:if(!(s<l.length))return[3,4];c=l[s];return[4,n.updateVisual(c,o)];case 2:m.sent();m.label=3;case 3:s++;return[3,1];case 4:return[2]}})};n=this;i=0,s=this.types;d.label=1;case 1:if(!(i<s.length))return[3,4];l=s[i];return[5,o(l)];case 2:d.sent();d.label=3;case 3:i++;return[3,1];case 4:for(c=0,u=a;c<u.length;c++){m=u[c];this.groups.locked.delete(m);if(this.groups.toBeRemoved.has(m))this.remove(m)}return[2]}})})};s.prototype.invalidateParams=function(e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(t){switch(t.label){case 0:r=this.params;if(r.displayType!==e.displayType||r.detailLevel!==e.detailLevel||r.radius!==e.radius){this.params=e;this.update();return[2]}this.params=e;return[4,this.invalidateStyles()];case 1:t.sent();return[2]}})})};s.prototype.dispose=function(){this.clear();e.Bootstrap.Command.Toast.Hide.dispatch(this.context,{key:i});for(var r=0,t=this.obs;r<t.length;r++){var a=t[r];a.dispose()}this.obs=[]};s.prototype.register=function(r){var t=this;this.behaviour=r;var a=this.params.source==="X-ray"?"Streaming enabled, click on a residue or an atom to view the data.":"Streaming enabled, showing full surface. To view higher detail, use 'Around Selection' mode.";e.Bootstrap.Command.Toast.Show.dispatch(this.context,{key:i,title:"Density",message:a,timeoutMs:30*1e3});this.obs.push(this.context.behaviours.select.subscribe(function(e){if(t.tryUpdateSelectionDataBox(e)){if(t.params.displayType==="Around Selection"){t.update()}}}));if(this.params.displayType==="Everything")this.update()};return s}();r.Behaviour=s})(t=r.DensityStreaming||(r.DensityStreaming={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t]};return function(r,t){e(r,t);function a(){this.constructor=r}r.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();var LiteMol;(function(e){var r;(function(r){var t;(function(r){"use strict";var t=e.Plugin.React;var a=e.Plugin.Controls;var o=function(e){__extends(o,e);function o(){return e!==null&&e.apply(this,arguments)||this}o.prototype.renderControls=function(){var e=this;var o=this.params;return t.createElement("div",null,t.createElement(a.OptionsGroup,{options:r.FieldSources,caption:function(e){return e},current:o.source,onChange:function(r){return e.updateParams({source:r})},label:"Source",title:"Determines how to obtain the data."}),t.createElement(a.TextBoxGroup,{value:o.id,onChange:function(r){return e.updateParams({id:r})},label:"Id",onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter id..."}),t.createElement(a.TextBoxGroup,{value:o.server,onChange:function(r){return e.updateParams({server:r})},label:"Server",onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter server..."}))};return o}(e.Plugin.Views.Transform.ControllerBase);r.CreateView=o;r.IsoInfo={EM:{min:-5,max:5,dataKey:"EM"},"2Fo-Fc":{min:0,max:2,dataKey:"2FO-FC"},"Fo-Fc(+ve)":{min:0,max:5,dataKey:"FO-FC"},"Fo-Fc(-ve)":{min:-5,max:0,dataKey:"FO-FC"}};var n=function(o){__extends(n,o);function n(){return o!==null&&o.apply(this,arguments)||this}n.prototype.updateIso=function(e,r){var t=__assign({},this.params.isoValues,(a={},a[e]=r,a));this.controller.autoUpdateParams({isoValues:t});var a};n.prototype.iso=function(o){var n=this;var i=this.params;var s=i.isoValueType===e.Bootstrap.Visualization.Density.IsoValueType.Sigma;var l=s?o+" σ":o;var c=i.header.channels.indexOf(r.IsoInfo[o].dataKey);var u=i.header.sampling[0].valuesInfo[c];var m=i.header.sampling[i.header.sampling.length-1].valuesInfo[c];var d=r.IsoInfo[o];var p=i.isoValues[o];var f=(m.min-m.mean)/m.sigma;var h=(m.max-m.mean)/m.sigma;var v,B;if(s){if(o==="EM"){v=Math.max((u.min-u.mean)/u.sigma,f);B=Math.min((u.max-u.mean)/u.sigma,h)}else{v=d.min;B=d.max}}else{v=Math.max(u.mean+f*u.sigma,u.min);B=Math.min(u.mean+h*u.sigma,u.max)}return t.createElement(a.Slider,{label:l,onChange:function(e){return n.updateIso(o,e)},min:v,max:B,value:p,step:.001})};n.prototype.style=function(r){var o=this;var n=this.getPersistentState("showTypeOptions-"+r,false);var i=this.params[r].theme;var s=this.params[r].params;var l=i.colors.get("Uniform");return t.createElement(a.ExpandableGroup,{select:this.iso(r),expander:t.createElement(a.ControlGroupExpander,{isExpanded:n,onChange:function(e){return o.setPersistentState("showTypeOptions-"+r,e)}}),colorStripe:l,options:[t.createElement(a.ToggleColorPicker,{key:"Uniform",label:"Color",color:l,onChange:function(e){return o.controller.updateThemeColor("Uniform",e,r)}}),t.createElement(e.Plugin.Views.Transform.TransparencyControl,{definition:i.transparency,onChange:function(e){return o.controller.updateThemeTransparency(e,r)}}),t.createElement(a.Toggle,{onChange:function(e){return o.controller.updateStyleParams({isWireframe:e},r)},value:s.isWireframe,label:"Wireframe"})],isExpanded:n})};n.prototype.details=function(){var e=this;var r=this.params.header.availablePrecisions;if(r.length<2)return void 0;var o=this.params;var n=o.detailLevel;var i=r.map(function(e){var r=""+Math.ceil(Math.pow(e.maxVoxels,1/3));return r+" × "+r+" × "+r});return t.createElement(a.OptionsGroup,{options:i,caption:function(e){return e},current:i[n],title:"Determines the detail level of the surface.",onChange:function(r){return e.autoUpdateParams({detailLevel:i.indexOf(r)})},label:"Max Voxels"})};n.prototype.updateValueType=function(t){var a=this.params;var o=a.isoValueType===e.Bootstrap.Visualization.Density.IsoValueType.Sigma;if(o===t)return;var n={};for(var i=0,s=Object.getOwnPropertyNames(a.isoValues);i<s.length;i++){var l=s[i];var c=a.header.channels.indexOf(r.IsoInfo[l].dataKey);var u=a.header.sampling[0].valuesInfo[c];var m=a.isoValues[l];n[l]=t?(m-u.mean)/u.sigma:u.mean+u.sigma*m}this.controller.autoUpdateParams({isoValueType:t?e.Bootstrap.Visualization.Density.IsoValueType.Sigma:e.Bootstrap.Visualization.Density.IsoValueType.Absolute,isoValues:n})};n.prototype.displayType=function(){var r=this;var o=this.getPersistentState("showDisplayOptions",false);var n=this.params;var i=n.isoValueType===e.Bootstrap.Visualization.Density.IsoValueType.Sigma;var s=t.createElement(a.OptionsGroup,{options:["Everything","Around Selection"],caption:function(e){return e},current:n.displayType,onChange:function(e){return r.autoUpdateParams({displayType:e})},label:"Show"});return t.createElement(a.ExpandableGroup,{select:s,expander:t.createElement(a.ControlGroupExpander,{isExpanded:o,onChange:function(e){return r.setPersistentState("showDisplayOptions",e)}}),options:[this.details(),t.createElement(a.Toggle,{onChange:function(e){return r.updateValueType(e)},value:i,label:"Relative (\\u03C3)",title:"Specify contour level as relative (\\u03C3) or absolute value."})],isExpanded:o})};n.prototype.renderControls=function(){var e=this;var r=this.params;return t.createElement("div",null,r.source==="EM"?[this.style("EM")]:[this.style("2Fo-Fc"),this.style("Fo-Fc(+ve)"),this.style("Fo-Fc(-ve)")],r.displayType==="Everything"?void 0:t.createElement(a.Slider,{label:"Radius",onChange:function(r){return e.autoUpdateParams({radius:r})},min:0,max:r.maxRadius,step:.005,value:r.radius}),this.displayType())};return n}(e.Plugin.Views.Transform.ControllerBase);r.StreamingView=n})(t=r.DensityStreaming||(r.DensityStreaming={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t;(function(r){var t=e.Visualization.THREE;var a=e.Core.Geometry.LinearAlgebra;var o=e.Core.Geometry;var n=e.Visualization;var i=a.Matrix4;var s=a.Vector3;var l=.806;r.Sphere=c(new t.IcosahedronGeometry(1,2));r.Cube=c(new t.BoxGeometry(2*l,2*l,2*l));r.Diamond=c(new t.OctahedronGeometry(1.3,0));r.Cone=c(new t.CylinderGeometry(0,1,1.6,32,1),[0,.5,0]);r.ConeLeft=c(new t.CylinderGeometry(0,1,1.6,16,1,false,0,Math.PI),[0,.5,0]);r.ConeRight=c(new t.CylinderGeometry(0,1,1.6,16,1,false,0,-Math.PI),[0,.5,0]);r.Star=c(u());r.FlatRectangle=c(new t.BoxGeometry(l,l,2*l));r.FlatDiamond=c(m(4,.66));r.FlatPentagon=c(m(5,.66));r.FlatHexagon=c(m(6,.66),void 0,[.75,1,1]);function c(e,r,t){e.computeVertexNormals();var a=n.GeometryHelper.toSurface(e);e.dispose();if(t){var s=i.fromScaling(i.zero(),t);o.Surface.transformImmediate(a,s)}if(r){var s=i.fromTranslation(i.zero(),r);o.Surface.transformImmediate(a,s)}return a}function u(){var e=[],r=5;for(var a=0;a<r*2;a++){var o=a%2==1?.2:.85;var n=a/r*Math.PI;e.push(new t.Vector2(Math.cos(n)*o,Math.sin(n)*o))}return new t.ExtrudeGeometry(new t.Shape(e),{amount:0,steps:2,bevelEnabled:true,bevelThickness:.25,bevelSize:.15,bevelSegments:12})}function m(e,r){var a=[];for(var o=0;o<e;o++){var n=2*o/e*Math.PI;a.push(new t.Vector2(Math.cos(n),Math.sin(n)))}var i=new t.Shape(a);var s=new t.LineCurve3(new t.Vector3(0,0,-r/2),new t.Vector3(0,0,r/2));return new t.ExtrudeGeometry(i,{amout:r/2,steps:2,bevelEnabled:false,extrudePath:s})}function d(e){var r=Math.ceil(e.triangleCount/2),t=Math.floor(e.triangleCount/2);var a=new Uint32Array(r*3),o=new Uint32Array(t*3);var n=0,i=0;for(var s=0;s<e.triangleIndices.length;s+=6){a[n++]=e.triangleIndices[s];a[n++]=e.triangleIndices[s+1];a[n++]=e.triangleIndices[s+2]}for(var s=3;s<e.triangleIndices.length;s+=6){o[i++]=e.triangleIndices[s];o[i++]=e.triangleIndices[s+1];o[i++]=e.triangleIndices[s+2]}return[__assign({},e,{triangleCount:r,triangleIndices:a,boundingSphere:void 0}),__assign({},e,{triangleCount:t,triangleIndices:o,boundingSphere:void 0})]}r.stripe=d;function p(e){var r=Math.ceil(e.triangleCount/2),t=Math.floor(e.triangleCount/2);var a=new Uint32Array(r*3),o=new Uint32Array(t*3);var n=0,i=0;var s=r*3;for(var l=0;l<s;l+=3){a[n++]=e.triangleIndices[l];a[n++]=e.triangleIndices[l+1];a[n++]=e.triangleIndices[l+2]}for(var l=s;l<e.triangleIndices.length;l+=3){o[i++]=e.triangleIndices[l];o[i++]=e.triangleIndices[l+1];o[i++]=e.triangleIndices[l+2]}return[__assign({},e,{triangleCount:r,triangleIndices:a,boundingSphere:void 0}),__assign({},e,{triangleCount:t,triangleIndices:o,boundingSphere:void 0})]}r.split=p;var f=i();i.setValue(f,3,3,1);function h(e,r,t){for(var a=0;a<3;a++){i.setValue(f,a,0,e[a]);i.setValue(f,a,1,r[a]);i.setValue(f,a,2,t[a])}return i.determinant(f)<0?-1:1}function v(e,r){var t=r.ringAtoms,a=r.ringCenter;var o=e.positions,n=o.x,i=o.y,l=o.z;var c=t[t.length-1],u=t[1],m=t[3];var d=s.sub(s(),s(n[u],i[u],l[u]),s(n[c],i[c],l[c]));var p=s.sub(s(),s(n[m],i[m],l[m]),s(n[c],i[c],l[c]));var f=s.cross(s(),d,p);var h=t[0];var v=s.sub(s(),s(n[h],i[h],l[h]),a);return{ringNormal:f,towardsC1:v}}var B=i();function A(e,r,t){var a=t.representation,o=a.axisUp,n=a.axisSide;var l=s.makeRotation(B,o,e);var c=s.transformMat4(s(),n,l);var u=h(c,r,e)*s.angle(c,r);var m=Math.abs(u)>.001?i.fromRotation(i(),u,e):i.fromIdentity(i());return i.mul(m,m,l)}function y(e,r,t){var a=s.cross(s(),e,r);if(t*a[2]<0)s.scale(a,a,-1);s.normalize(a,a);return a}function g(e,r,t,a){var o=t.links,n=t.terminalLinks;var i=o.length,l=n.length;var c;if(i>1&&l>0){c=s();for(var u=0,m=n;u<m.length;u++){var d=m[u];var p=s.sub(s(),d.centerB,d.centerA);s.normalize(p,p);s.add(c,c,p)}s.normalize(c,c)}else if(i===1){c=s.sub(s(),o[0].centerA,o[0].centerB)}else if(i===2){var f=s.sub(s(),o[0].centerA,o[0].centerB);var h=s.sub(s(),o[1].centerA,o[1].centerB);s.normalize(f,f);s.normalize(h,h);c=s.add(s(),f,h)}else if(i===3){var v=s.sub(s(),o[0].centerA,o[0].centerB);var B=s.sub(s(),o[1].centerA,o[1].centerB);var g=s.sub(s(),o[2].centerA,o[2].centerB);var C=y(v,B,e[2]);var b=y(v,g,e[2]);var T=y(B,g,e[2]);var S=s.angle(C,g);var D=s.angle(b,B);var M=s.angle(T,v);var w=S;c=C;if(D>w){w=D;c=b}if(M>w){w=M;c=T}}else{c=e}return A(c,r,t)}function C(e,r,t,a){var o=r.ringCenter,n=r.ringRadius;var i=v(e,r),s=i.ringNormal,l=i.towardsC1;var c=g(s,l,r,a);var u=t*n;return{scale:[u,u,u],rotation:c,translation:o}}r.makeTransform=C})(t=r.Shapes||(r.Shapes={}))})(t=r.Carbohydrates||(r.Carbohydrates={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t;(function(t){t.RingNames=[{__len:6,C1:0,C2:1,C3:2,C4:3,C5:4,O5:5},{__len:6,C1:0,C2:1,C3:2,C4:3,C5:4,O:5},{__len:6,C2:0,C3:1,C4:2,C5:3,C6:4,O6:5},{__len:5,C1:0,C2:1,C3:2,C4:3,O4:4},{__len:5,"C1'":0,"C2'":1,"C3'":2,"C4'":3,"O4'":4}];var a=[{shape:[r.Shapes.Sphere],axisUp:[0,0,1],instances:[{name:"Glc",common:{colorA:"#0090bc",names:["GLC","BGC"]},charmm:{colorA:"#0090bc",names:["AGLC","BGLC"]},glycam:{colorA:"#0090bc",names:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"]}},{name:"Man",common:{colorA:"#00a651",names:["MAN","BMA"]},charmm:{colorA:"#00a651",names:["AMAN","BMAN"]},glycam:{colorA:"#00a651",names:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"]}},{name:"Gal",common:{colorA:"#ffd400",names:["GAL","GLA"]},charmm:{colorA:"#ffd400",names:["AGAL","BGAL"]},glycam:{colorA:"#ffd400",names:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"]}},{name:"Gul",common:{colorA:"#f47920",names:["GUP","GL0"]},charmm:{colorA:"#f47920",names:["AGUL","BGUL"]},glycam:{colorA:"#f47920",names:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"]}},{name:"Alt",common:{colorA:"#f69ea1",names:["ALT"]},charmm:{colorA:"#f69ea1",names:["AALT","BALT"]},glycam:{colorA:"#f69ea1",names:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"]}},{name:"All",common:{colorA:"#a54399",names:["ALL","AFD"]},charmm:{colorA:"#a54399",names:["AALL","BALL"]},glycam:{colorA:"#a54399",names:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"]}},{name:"Tal",common:{colorA:"#8fcce9",names:["TAL"]},charmm:{colorA:"#8fcce9",names:["ATAL","BTAL"]},glycam:{colorA:"#8fcce9",names:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"]}},{name:"Ido",common:{colorA:"#a17a4d",names:["4N2"]},charmm:{colorA:"#a17a4d",names:["AIDO","BIDO"]},glycam:{colorA:"#a17a4d",names:[]}}]},{shape:[r.Shapes.Cube],axisUp:[0,0,1],instances:[{name:"GlcNAc",common:{colorA:"#0090bc",names:["NAG","NDG"]},charmm:{colorA:"#0090bc",names:["AGLCNA","BGLCNA","BGLCN0"]},glycam:{colorA:"#0090bc",names:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"]}},{name:"ManNAc",common:{colorA:"#00a651",names:["BM3"]},charmm:{colorA:"#00a651",names:[]},glycam:{colorA:"#00a651",names:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"]}},{name:"GalNAc",common:{colorA:"#ffd400",names:["NGA","A2G"]},charmm:{colorA:"#ffd400",names:["AGALNA","BGALNA"]},glycam:{colorA:"#ffd400",names:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"]}},{name:"GulNAc",common:{colorA:"#f47920",names:[]},charmm:{colorA:"#f47920",names:[]},glycam:{colorA:"#f47920",names:[]}},{name:"AltNAc",common:{colorA:"#f69ea1",names:[]},charmm:{colorA:"#f69ea1",names:[]},glycam:{colorA:"#f69ea1",names:[]}},{name:"AllNAc",common:{colorA:"#a54399",names:["NAA"]},charmm:{colorA:"#a54399",names:[]},glycam:{colorA:"#a54399",names:[]}},{name:"TalNAc",common:{colorA:"#8fcce9",names:[]},charmm:{colorA:"#8fcce9",names:[]},glycam:{colorA:"#8fcce9",names:[]}},{name:"IdoNAc",common:{colorA:"#a17a4d",names:["HSQ"]},charmm:{colorA:"#a17a4d",names:[]},glycam:{colorA:"#a17a4d",names:[]}}]},{shape:r.Shapes.stripe(r.Shapes.Cube),axisUp:[0,0,1],instances:[{name:"GlcN",common:{colorA:"#0090bc",colorB:"#f1ece1",names:["GCS","PA1"]},charmm:{colorA:"#0090bc",colorB:"#f1ece1",names:[]},glycam:{colorA:"#0090bc",colorB:"#f1ece1",names:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"]}},{name:"ManN",common:{colorA:"#00a651",colorB:"#f1ece1",names:[]},charmm:{colorA:"#00a651",colorB:"#f1ece1",names:[]},glycam:{colorA:"#00a651",colorB:"#f1ece1",names:[]}},{name:"GalN",common:{colorA:"#ffd400",colorB:"#f1ece1",names:["X6X","1GN"]},charmm:{colorA:"#ffd400",colorB:"#f1ece1",names:[]},glycam:{colorA:"#ffd400",colorB:"#f1ece1",names:[]}},{name:"GulN",common:{colorA:"#f47920",colorB:"#f1ece1",names:[]},charmm:{colorA:"#f47920",colorB:"#f1ece1",names:[]},glycam:{colorA:"#f47920",colorB:"#f1ece1",names:[]}},{name:"AltN",common:{colorA:"#f69ea1",colorB:"#f1ece1",names:[]},charmm:{colorA:"#f69ea1",colorB:"#f1ece1",names:[]},glycam:{colorA:"#f69ea1",colorB:"#f1ece1",names:[]}},{name:"AllN",common:{colorA:"#a54399",colorB:"#f1ece1",names:[]},charmm:{colorA:"#a54399",colorB:"#f1ece1",names:[]},glycam:{colorA:"#a54399",colorB:"#f1ece1",names:[]}},{name:"TalN",common:{colorA:"#8fcce9",colorB:"#f1ece1",names:[]},charmm:{colorA:"#8fcce9",colorB:"#f1ece1",names:[]},glycam:{colorA:"#8fcce9",colorB:"#f1ece1",names:[]}},{name:"IdoN",common:{colorA:"#a17a4d",colorB:"#f1ece1",names:[]},charmm:{colorA:"#a17a4d",colorB:"#f1ece1",names:[]},glycam:{colorA:"#a17a4d",colorB:"#f1ece1",names:[]}}]},{shape:r.Shapes.split(r.Shapes.Diamond),axisUp:[1,0,0],instances:[{name:"GlcA",common:{colorA:"#0090bc",colorB:"#f1ece1",names:["GCU","BDP"]},charmm:{colorA:"#0090bc",colorB:"#f1ece1",names:["AGLCA","BGLCA","BGLCA0"]},glycam:{colorA:"#0090bc",colorB:"#f1ece1",names:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"]}},{name:"ManA",common:{colorA:"#00a651",colorB:"#f1ece1",names:["MAV","BEM"]},charmm:{colorA:"#00a651",colorB:"#f1ece1",names:[]},glycam:{colorA:"#00a651",colorB:"#f1ece1",names:[]}},{name:"GalA",common:{colorA:"#ffd400",colorB:"#f1ece1",names:["ADA","GTR"]},charmm:{colorA:"#ffd400",colorB:"#f1ece1",names:[]},glycam:{colorA:"#ffd400",colorB:"#f1ece1",names:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"]}},{name:"GulA",common:{colorA:"#f47920",colorB:"#f1ece1",names:["LGU"]},charmm:{colorA:"#f47920",colorB:"#f1ece1",names:[]},glycam:{colorA:"#f47920",colorB:"#f1ece1",names:[]}},{name:"AltA",common:{colorA:"#f1ece1",colorB:"#f69ea1",names:[]},charmm:{colorA:"#f1ece1",colorB:"#f69ea1",names:[]},glycam:{colorA:"#f1ece1",colorB:"#f69ea1",names:[]}},{name:"AllA",common:{colorA:"#a54399",colorB:"#f1ece1",names:[]},charmm:{colorA:"#a54399",colorB:"#f1ece1",names:[]},glycam:{colorA:"#a54399",colorB:"#f1ece1",names:[]}},{name:"TalA",common:{colorA:"#8fcce9",colorB:"#f1ece1",names:["X0X","X1X"]},charmm:{colorA:"#8fcce9",colorB:"#f1ece1",names:[]},glycam:{colorA:"#8fcce9",colorB:"#f1ece1",names:[]}},{name:"IdoA",common:{colorA:"#f1ece1",colorB:"#a17a4d",names:["IDR"]},charmm:{colorA:"#f1ece1",colorB:"#a17a4d",names:["AIDOA","BIDOA"]},glycam:{colorA:"#f1ece1",colorB:"#a17a4d",names:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"]}}]},{shape:[r.Shapes.Cone],axisUp:[0,1,0],instances:[{name:"Qui",common:{colorA:"#0090bc",names:["G6D"]},charmm:{colorA:"#0090bc",names:[]},glycam:{colorA:"#0090bc",names:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"]}},{name:"Rha",common:{colorA:"#00a651",names:["RAM","RM4"]},charmm:{colorA:"#00a651",names:["ARHM","BRHM"]},glycam:{colorA:"#00a651",names:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"]}},{name:"x6dAlt",common:{colorA:"#F88CD2",names:[]},charmm:{colorA:"#935D38",names:[]},glycam:{colorA:"#57913F",names:[]}},{name:"x6dTal",common:{colorA:"#B490DE",names:[]},charmm:{colorA:"#64CABE",names:[]},glycam:{colorA:"#D9147F",names:[]}},{name:"Fuc",common:{colorA:"#ed1c24",names:["FUC","FUL"]},charmm:{colorA:"#ed1c24",names:["AFUC","BFUC"]},glycam:{colorA:"#ed1c24",names:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"]}}]},{shape:[r.Shapes.ConeLeft,r.Shapes.ConeRight],axisUp:[0,1,0],instances:[{name:"QuiNAc",common:{colorA:"#0090bc",colorB:"#f1ece1",names:[]},charmm:{colorA:"#0090bc",colorB:"#f1ece1",names:[]},glycam:{colorA:"#0090bc",colorB:"#f1ece1",names:[]}},{name:"RhaNAc",common:{colorA:"#00a651",colorB:"#f1ece1",names:[]},charmm:{colorA:"#00a651",colorB:"#f1ece1",names:[]},glycam:{colorA:"#00a651",colorB:"#f1ece1",names:[]}},{name:"FucNAc",common:{colorA:"#ed1c24",colorB:"#f1ece1",names:[]},charmm:{colorA:"#ed1c24",colorB:"#f1ece1",names:[]},glycam:{colorA:"#ed1c24",colorB:"#f1ece1",names:[]}}]},{shape:[r.Shapes.FlatRectangle],axisUp:[0,1,0],instances:[{name:"Oli",common:{colorA:"#0090bc",names:["DDA"]},charmm:{colorA:"#0090bc",names:[]},glycam:{colorA:"#0090bc",names:[]}},{name:"Tyv",common:{colorA:"#00a651",names:["TYV"]},charmm:{colorA:"#00a651",names:[]},glycam:{colorA:"#00a651",names:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"]}},{name:"Abe",common:{colorA:"#f47920",names:["ABE"]},charmm:{colorA:"#f47920",names:[]},glycam:{colorA:"#f47920",names:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"]}},{name:"Par",common:{colorA:"#f69ea1",names:["PZU"]},charmm:{colorA:"#f69ea1",names:[]},glycam:{colorA:"#f69ea1",names:[]}},{name:"Dig",common:{colorA:"#a54399",names:[]},charmm:{colorA:"#a54399",names:[]},glycam:{colorA:"#a54399",names:[]}},{name:"Col",common:{colorA:"#8fcce9",names:[]},charmm:{colorA:"#8fcce9",names:[]},glycam:{colorA:"#8fcce9",names:[]}}]},{shape:[r.Shapes.Star],axisUp:[0,0,1],instances:[{name:"Ara",common:{colorA:"#00a651",names:["ARA","ARB"]},charmm:{colorA:"#00a651",names:["AARB","BARB"]},glycam:{colorA:"#00a651",names:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"]}},{name:"Lyx",common:{colorA:"#ffd400",names:["LDY"]},charmm:{colorA:"#ffd400",names:["ALYF","BLYF"]},glycam:{colorA:"#ffd400",names:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"]}},{name:"Xyl",common:{colorA:"#f47920",names:["XYS","XYP"]},charmm:{colorA:"#f47920",names:["AXYL","BXYL","AXYF","BXYF"]},glycam:{colorA:"#f47920",names:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"]}},{name:"Rib",common:{colorA:"#f69ea1",names:["RIP","0MK"]},charmm:{colorA:"#f69ea1",names:["ARIB","BRIB"]},glycam:{colorA:"#f69ea1",names:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"]}}]},{shape:[r.Shapes.Diamond],axisUp:[1,0,0],instances:[{name:"Kdn",common:{colorA:"#00a651",names:["KDN","KDM"]},charmm:{colorA:"#00a651",names:[]},glycam:{colorA:"#00a651",names:[]}},{name:"Neu5Ac",common:{colorA:"#a54399",names:["SIA","SLB"]},charmm:{colorA:"#a54399",names:["ANE5AC","BNE5AC"]},glycam:{colorA:"#a54399",names:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"]}},{name:"Neu5Gc",common:{colorA:"#8fcce9",names:["NGC","NGE"]},charmm:{colorA:"#8fcce9",names:[]},glycam:{colorA:"#8fcce9",names:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"]}},{name:"Neu",common:{colorA:"#a17a4d",names:[]},charmm:{colorA:"#a17a4d",names:[]},glycam:{colorA:"#a17a4d",names:[]}}]},{shape:[r.Shapes.FlatHexagon],axisUp:[0,0,1],instances:[{name:"Bac",common:{colorA:"#0090bc",names:["B6D"]},charmm:{colorA:"#0090bc",names:[]},glycam:{colorA:"#0090bc",names:["0BC","3BC","0bC","3bC"]}},{name:"LDManHep",common:{colorA:"#00a651",names:["GMH"]},charmm:{colorA:"#00a651",names:[]},glycam:{colorA:"#00a651",names:[]}},{name:"Kdo",common:{colorA:"#ffd400",names:["KDO"]},charmm:{colorA:"#ffd400",names:[]},glycam:{colorA:"#ffd400",names:[]}},{name:"Dha",common:{colorA:"#f47920",names:[]},charmm:{colorA:"#f47920",names:[]},glycam:{colorA:"#f47920",names:[]}},{name:"DDManHep",common:{colorA:"#f69ea1",names:[]},charmm:{colorA:"#f69ea1",names:[]},glycam:{colorA:"#f69ea1",names:[]}},{name:"MurNAc",common:{colorA:"#a54399",names:["AMU"]},charmm:{colorA:"#a54399",names:[]},glycam:{colorA:"#a54399",names:[]}},{name:"MurNGc",common:{colorA:"#8fcce9",names:[]},charmm:{colorA:"#8fcce9",names:[]},glycam:{colorA:"#8fcce9",names:[]}},{name:"Mur",common:{colorA:"#a17a4d",names:["MUR"]},charmm:{colorA:"#a17a4d",names:[]},glycam:{colorA:"#a17a4d",names:[]}}]},{shape:[r.Shapes.FlatPentagon],axisUp:[0,0,1],instances:[{name:"Api",common:{colorA:"#0090bc",names:["XXM"]},charmm:{colorA:"#0090bc",names:[]},glycam:{colorA:"#0090bc",names:[]}},{name:"Fruc",common:{colorA:"#00a651",names:["BDF"]},charmm:{colorA:"#00a651",names:["AFRU","BFRU"]},glycam:{colorA:"#00a651",names:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"]}},{name:"Tag",common:{colorA:"#ffd400",names:["T6T"]},charmm:{colorA:"#ffd400",names:[]},glycam:{colorA:"#ffd400",names:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"]}},{name:"Sor",common:{colorA:"#f47920",names:["SOE"]},charmm:{colorA:"#f47920",names:[]},glycam:{colorA:"#f47920",names:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"]}},{name:"Psi",common:{colorA:"#f69ea1",names:[]},charmm:{colorA:"#f69ea1",names:[]},glycam:{colorA:"#f69ea1",names:[]}}]},{shape:[r.Shapes.FlatDiamond],axisUp:[0,0,1],instances:[{name:"Pse",common:{colorA:"#00a850",names:["6PZ"]},charmm:{colorA:"#00a850",names:[]},glycam:{colorA:"#00a850",names:[]}},{name:"Leg",common:{colorA:"#f9d10d",names:[]},charmm:{colorA:"#f9d10d",names:[]},glycam:{colorA:"#f9d10d",names:[]}},{name:"Aci",common:{colorA:"#f69e9d",names:[]},charmm:{colorA:"#f69e9d",names:[]},glycam:{colorA:"#f69e9d",names:[]}},{name:"4eLeg",common:{colorA:"#89c6e3",names:[]},charmm:{colorA:"#89c6e3",names:[]},glycam:{colorA:"#89c6e3",names:[]}}]}];var o=function(){var r=e.Core.Utils.FastMap.create();var t=function(t){var a=function(a){var o=function(o,n){return r.set(o,{instanceName:a.name,name:o,color:n.colorB?[e.Visualization.Color.fromHexString(n.colorA),e.Visualization.Color.fromHexString(n.colorB)]:[e.Visualization.Color.fromHexString(n.colorA)],shape:t.shape,axisUp:t.axisUp,axisSide:[1,0,0]})};for(var n=0,i=a.common.names;n<i.length;n++){var s=i[n];o(s,a.common)}};for(var o=0,n=t.instances;o<n.length;o++){var i=n[o];a(i)}};for(var o=0,n=a;o<n.length;o++){var i=n[o];t(i)}return r}();function n(e){return o.has(e)}t.isResidueRepresentable=n;function i(e){return o.get(e)}t.getResidueRepresentation=i})(t=r.Mapping||(r.Mapping={}))})(t=r.Carbohydrates||(r.Carbohydrates={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t=e.Core.Structure;var a=e.Core.Geometry.LinearAlgebra;var o=e.Bootstrap.Entity;var n=e.Bootstrap.Tree;r.Types=["Icons","Full"];r.FullSizes=["Small","Medium","Large"];r.DefaultIconsParams={type:"Icons",iconScale:.55};r.DefaultFullParams={type:"Full",fullSize:"Large",linkColor:e.Visualization.Color.fromRgb(255*.6,255*.6,255*.6),showTerminalLinks:true,showTerminalAtoms:false};function i(e,t){var a=e.data.residues.name;for(var o=0,n=t;o<n.length;o++){var i=n[o];if(!r.Mapping.isResidueRepresentable(a[i]))return true}return false}r.isRepresentable=i;var s;(function(t){var a=this;t.CarbohydratesInfo=o.create({name:"Carbohydrate Information",typeClass:"Object",shortName:"CI",description:"Information about carbohydrate residues."});t.CreateInfo=n.Transformer.create({id:"carbohydrate-representation-create-info",name:"Carbohydrates",description:"Information about carbohydrate residues.",from:[o.Molecule.Model],to:[t.CarbohydratesInfo],isApplicable:function(){return false},isUpdatable:false,defaultParams:function(){return{}}},function(r,a,o){return e.Bootstrap.Task.resolve("Carbohydrates","Silent",t.CarbohydratesInfo.create(o,{label:"Carbohydrates",info:o.params.info}))});t.CreateVisual=n.Transformer.create({id:"carbohydrate-representation-create-visual",name:"3D-SNFG",description:"Create carbohydrate representation using 3D-SNFG shapes.",from:[t.CarbohydratesInfo],to:[o.Molecule.Visual],isUpdatable:true,defaultParams:function(){return r.DefaultFullParams}},function(r,t,o){return e.Bootstrap.Task.create("Carbohydrate Representation","Background",function(r){return __awaiter(a,void 0,void 0,function(){var a,n,i,s,l,c,m,d,p,f,h,v;return __generator(this,function(B){switch(B.label){case 0:a=e.Bootstrap.Utils.Molecule.findModel(t);if(!a)throw Error("Carbohydrate representation requires a Molecule.Model entity ancestor.");n=u(a.props.model,t.props.info,o.params),i=n.surface,s=n.theme,l=n.tags,c=n.mapper;p=(d=e.Visualization.Surface.Model).create;f=[t];h={};return[4,i.run(r)];case 1:return[4,p.apply(d,f.concat([(h.surface=B.sent(),h.theme=s,h.parameters={mapPickElements:c},h)])).run(r)];case 2:m=B.sent();v={type:"Surface",taskType:"Background",params:{},theme:void 0};return[2,e.Bootstrap.Entity.Molecule.Visual.create(o,{label:"3D-SNFG",model:m,style:v,isSelectable:true,tag:l})]}})})}).setReportTime(true)},function(r,t,a){var o=__assign({},t.transform.params);var i=__assign({},a.params);if(o.type!=="Full"||i.type!=="Full")return void 0;delete o.linkColor;delete i.linkColor;if(!e.Bootstrap.Utils.deepEqual(o,i))return void 0;var s=t.props.tag.colors;var l=e.Visualization.Theme.createColorMapMapping(function(e){return e},s,a.params.type==="Full"?a.params.linkColor:e.Visualization.Color.fromHexString("#666666"));var c=e.Visualization.Theme.createMapping(l);t.props.model.applyTheme(c);return e.Bootstrap.Task.resolve(a.transformer.info.name,"Background",n.Node.Null)})})(s=r.Transforms||(r.Transforms={}));function l(r){return{links:[],map:e.Core.Utils.FastMap.create(),entries:[],carbohydrateIndices:[],terminalIndices:[],warnings:r}}r.EmptyInfo=l;function c(r){var t=r.model,a=r.fragment,o=r.atomMask,n=r.bonds;var i=v(t,a.residueIndices),s=i.residueIndices,c=i.entries,u=i.warnings;if(!s.length){return l(u)}var m=e.Core.Utils.FastMap.create();for(var d=0,f=s.length;d<f;d++){m.set(s[d],d)}var h=p({model:t,atomMask:o,bonds:n,carbohydrateMap:m,entries:c}),B=h.links,A=h.terminalIndices;return{links:B,map:m,entries:c,carbohydrateIndices:s,terminalIndices:A,warnings:u}}r.getInfo=c;function u(a,o,n){var i=o.carbohydrateIndices,s=o.entries,l=o.links;var c=e.Visualization.Primitive.Builder.create();var u=e.Core.Utils.FastMap.create();var d=e.Core.Utils.FastMap.create();var p=n.type==="Full"?n.fullSize==="Small"?.55:n.fullSize==="Medium"?.75:1.1:n.iconScale;var f=0;for(var h=0;h<i.length;h++){var v=s[h].representation;var B=r.Shapes.makeTransform(a,s[h],p,n.type);var A=0;for(var y=0,g=v.shape;y<g.length;y++){var C=g[y];d.set(f,v.color[A++]);u.set(f,{type:"Residue",instanceName:v.instanceName,residueIndex:i[h],model:a});c.add(__assign({type:"Surface",surface:C,id:f++},B))}}if(n.type==="Full"){var b=n.showTerminalLinks,T=n.showTerminalAtoms;var S=n.fullSize==="Small"?.12:n.fullSize==="Medium"?.2:.28;for(var D=0,M=l;D<M.length;D++){var w=M[D];switch(w.type){case"Carbohydrate":{var x=w.centerA,V=w.centerB;c.add({type:"Tube",id:f++,radius:S,slices:12,a:x,b:V});break}case"Terminal":{if(!b)continue;var E=w.rB,I=w.bondType,x=w.centerA,V=w.centerB;if(t.isBondTypeCovalent(I)){c.add({type:"Tube",id:f++,radius:S/2,slices:8,a:x,b:V})}else{c.add({type:"DashedLine",id:f++,width:S/2,dashSize:.33,spaceSize:.33,a:x,b:V})}if(T){var U=2*S;u.set(f,{type:"Terminal",residueIndex:E,model:a});c.add({type:"Surface",surface:r.Shapes.Sphere,id:f++,scale:[U,U,U],translation:V})}break}}}}var F=e.Visualization.Theme.createColorMapMapping(function(e){return e},d,n.type==="Full"?n.linkColor:e.Visualization.Color.fromHexString("#666666"));var P=e.Visualization.Theme.createMapping(F);var R={type:"CarbohydrateRepresentation",colors:d};return{surface:c.buildSurface(),mapper:m(a,u),tags:R,theme:P}}r.getRepresentation=u;function m(e,r){var t=e.data.residues,a=t.atomStartIndex,o=t.atomEndIndex;return function(e){var t=r.get(e);if(!t)return void 0;var n=[];if(t.type!=="Link"){for(var i=a[t.residueIndex],s=o[t.residueIndex];i<s;i++)n.push(i)}else{var l=t.link.rA;for(var i=a[l],s=o[l];i<s;i++)n.push(i);l=t.link.rB;for(var i=a[l],s=o[l];i<s;i++)n.push(i)}return n}}function d(e){return{type:e.type,rA:e.rB,rB:e.rA,atomA:e.atomB,atomB:e.atomA,centerA:e.centerB,centerB:e.centerA,bondType:e.bondType}}function p(r){var t=r.model,o=r.bonds,n=r.atomMask,i=r.carbohydrateMap,s=r.entries;var l=o.atomAIndex,c=o.atomBIndex,u=o.type;var m=t.data.atoms.residueIndex;var p=t.positions,f=p.x,h=p.y,v=p.z;var B=e.Core.Utils.FastSet.create();var A=[];var y=e.Core.Utils.UniqueArray();for(var g=0,C=o.count;g<C;g++){var b=l[g],T=c[g];if(!n.has(b)||!n.has(T))continue;var S=Math.min(b,T),D=Math.max(b,T);var M=m[S],w=m[D];var x=i.has(M),V=i.has(w);var E=u[g];if(x&&V){if(M===w)continue;var I=M+" "+w;if(B.has(I))continue;B.add(I);var U=s[i.get(M)],F=s[i.get(w)];var P={type:"Carbohydrate",rA:M,rB:w,atomA:S,atomB:D,centerA:U.ringCenter,centerB:F.ringCenter,bondType:E};A.push(P);U.links.push(P);F.links.push(d(P))}else if(x){var U=s[i.get(M)];var P={type:"Terminal",rA:M,rB:w,atomA:S,atomB:D,centerA:U.ringCenter,centerB:a.Vector3(f[D],h[D],v[D]),bondType:E};A.push(P);U.terminalLinks.push(P);e.Core.Utils.UniqueArray.add(y,w)}else if(V){var F=s[i.get(w)];var P={type:"Terminal",rA:w,rB:M,atomA:D,atomB:S,centerA:F.ringCenter,centerB:a.Vector3(f[S],h[S],v[S]),bondType:E};A.push(P);F.terminalLinks.push(P);e.Core.Utils.UniqueArray.add(y,M)}}return{links:A,terminalIndices:y.array}}function f(e,t){return"Residue '"+r.formatResidueName(e,t)+"' has a recognized carbohydrate name, but is missing ring atoms with standard names."}function h(r,t,o){var n=e.Bootstrap.Utils.Molecule.getCentroidAndRadius(r,t,o);if(n>1.95)return 0;var i=a.Vector3.zero(),s=a.Vector3.zero();var l=r.positions,c=l.x,u=l.y,m=l.z;var d=t.length;for(var p=0;p<d-1;p++){var f=t[p];a.Vector3.set(i,c[f],u[f],m[f]);for(var h=p+1;h<d;h++){var v=t[h];a.Vector3.set(s,c[v],u[v],m[v]);if(a.Vector3.squaredDistance(i,s)>16)return 0}}return n}function v(e,t){var o=e.data.residues.name;var n=[],i=[],s=[];for(var l=0,c=t;l<c.length;l++){var u=c[l];if(!r.Mapping.isResidueRepresentable(o[u]))continue;var m=B(e,u);if(!m.length){s.push(f(e,u));continue}var d=false;for(var p=0,v=m;p<v.length;p++){var A=v[p];var y=a.Vector3.zero();var g=h(e,A,y);if(g===0)continue;n.push(u);i.push({representation:r.Mapping.getResidueRepresentation(o[u]),ringAtoms:A,ringCenter:y,ringRadius:g,links:[],terminalLinks:[]});d=true;break}if(!d){s.push(f(e,u))}}return{residueIndices:n,entries:i,warnings:s}}function B(e,t){var a=e.data.residues,o=a.atomStartIndex,n=a.atomEndIndex;var i=e.data.atoms.name;var s=[];for(var l=0,c=r.Mapping.RingNames;l<c.length;l++){var u=c[l];var m=[];var d=0;for(var p=0;p<u.__len;p++)m.push(0);for(var f=o[t],h=n[t];f<h;f++){var v=u[i[f]];if(v===void 0)continue;m[v]=f;d++;if(d===m.length)s.push(m)}}return s}})(t=r.Carbohydrates||(r.Carbohydrates={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t=e.Bootstrap.Interactivity;function a(e,r){var t=e.data.residues,a=t.authName,o=t.authAsymId,n=t.authSeqNumber,i=t.insCode;return a[r]+" "+o[r]+" "+n[r]+(i[r]!==null?" i: "+i[r]:"")}r.formatResidueName=a;function o(e){e.highlight.addProvider(function(e){if(!t.Molecule.isMoleculeModelInteractivity(e))return void 0;var a=t.Molecule.transformInteraction(e);if(!a||a.residues.length!==1)return void 0;var o=r.Mapping.getResidueRepresentation(a.residues[0].name);if(!o)return void 0;return"Carb: <b>"+o.instanceName+"</b>"})}r.HighlightCustomElementsBehaviour=o})(t=r.Carbohydrates||(r.Carbohydrates={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t=e.Core.Utils;var a=e.Core.Structure;var o=a.Query;var n=10;var i=2;function s(e,n,i){return __awaiter(this,void 0,void 0,function(){var s,u,d,p,f,h,v,B,A,y,g,C,b,T,S,D,M,w,x,V,E,I,U,F,P,R,L,_,k,N,G,W,z,Y,V,E,I,U,O,q,Z,Q,N,H,X,j,K,J,$,ee,N,H,re,te,ae,N,H,oe;return __generator(this,function(ne){switch(ne.label){case 0:return[4,e.updateProgress("Determing main sequence atoms...")];case 1:ne.sent();s=m(n,i);u=n.data.modifiedResidues;d=u&&u.count>0;if(s.length===i.atomCount&&!d){p={sequence:{all:s,interacting:[],modified:[]},het:{other:[],carbohydrates:r.Carbohydrates.EmptyInfo([])},freeWaterAtoms:[]};return[2,p]}f=o.Context.ofAtomIndices(n,s);h=l(n,f);if(s.length===i.atomCount){v={sequence:{all:s,interacting:[],modified:h},het:{other:[],carbohydrates:r.Carbohydrates.EmptyInfo([])},freeWaterAtoms:[]};return[2,v]}B=o.entities({type:"water"}).union().compile()(i).unionAtomIndices();A=o.or(o.atomsFromIndices(B),o.atomsFromIndices(s)).complement().ambientResidues(c(n)).union().compile();y=A(i).fragments[0];if(!y){g={sequence:{all:s,interacting:[],modified:h},het:{other:[],carbohydrates:r.Carbohydrates.EmptyInfo([])},freeWaterAtoms:B};return[2,g]}return[4,e.updateProgress("Computing bonds...")];case 2:ne.sent();C=a.computeBonds(n,y.atomIndices);b=n.data.atoms,T=b.entityIndex,S=b.residueIndex;D=n.data.entities.type;M=C.atomAIndex,w=C.atomBIndex;return[4,e.updateProgress("Identifying free waters...")];case 3:ne.sent();x=t.FastSet.create();for(V=0,E=C.count;V<E;V++){I=M[V],U=w[V];F=D[T[I]],P=D[T[U]];if(F==="water"){if(P!=="water")x.add(S[I])}else if(P==="water"){x.add(S[U])}}R=new Int32Array(B.length-x.size);L=0;for(_=0,k=B;_<k.length;_++){N=k[_];if(!x.has(N))R[L++]=N}return[4,e.updateProgress("Identifying HET groups...")];case 4:ne.sent();G=f.mask;W=t.ChunkedArray.forInt32(y.atomCount/2);z=t.FastSet.create(),Y=t.FastSet.create();for(V=0,E=C.count;V<E;V++){I=M[V],U=w[V];O=G.has(I),q=G.has(U);if(O){if(!q){z.add(S[I]);Y.add(U)}}else if(q){z.add(S[U]);Y.add(I)}}for(Z=0,Q=y.atomIndices;Z<Q.length;Z++){N=Q[Z];H=S[N];if(G.has(N)&&!z.has(H))continue;if(D[T[N]]==="water"&&!x.has(H))continue;t.ChunkedArray.add(W,N)}X=t.ChunkedArray.compact(W);return[4,e.updateProgress("Identifying carbohydrates...")];case 5:ne.sent();j=r.Carbohydrates.getInfo({model:n,fragment:o.Fragment.ofArray(i,X[0],X),atomMask:i.mask,bonds:C});return[4,e.updateProgress("Identifying non-carbohydrate HET groups...")];case 6:ne.sent();K=t.ChunkedArray.forInt32(X.length);J=j.map;for($=0,ee=X;$<ee.length;$++){N=ee[$];H=S[N];if(!J.has(H)&&!G.has(N))t.ChunkedArray.add(K,N)}return[4,e.updateProgress("Identifying interacting sequence residues...")];case 7:ne.sent();re=t.ChunkedArray.forInt32(X.length);for(te=0,ae=X;te<ae.length;te++){N=ae[te];H=S[N];if(z.has(H)||Y.has(N)&&!J.has(H))t.ChunkedArray.add(re,N)}oe={sequence:{all:s,interacting:t.ChunkedArray.compact(re),modified:h},het:{other:t.ChunkedArray.compact(K),carbohydrates:j},freeWaterAtoms:R};return[2,oe]}})})}r.createComplexRepresentation=s;function l(e,r){var t=e.data.modifiedResidues;var a=t&&t.count>0;if(!t||!a)return[];var n=t.asymId,i=t.seqNumber,s=t.insCode;var l=[];for(var c=0,u=t.count;c<u;c++){l.push({asymId:n[c],seqNumber:i[c],insCode:s[c]})}var m=o.residues.apply(null,l).compile();return m(r).unionAtomIndices()}function c(e){var r=3;if(e.data.bonds.structConn){for(var t=0,a=e.data.bonds.structConn.entries;t<a.length;t++){var o=a[t];if(o.distance>r)r=o.distance}}return r+.1}function u(e,r,t){var a=e.data.secondaryStructure;var o=e.data.chains,n=o.residueStartIndex,i=o.residueEndIndex;var s=e.data.residues,l=s.atomStartIndex,c=s.atomEndIndex,u=s.secondaryStructureIndex;var m=0;var d=false,p=false;for(var f=n[r],h=i[r];f<h;f++){var v=a[u[f]].type;if(v===5){p=true}else if(v!==0){d=true}for(var B=l[f],A=c[f];B<A;B++){if(t.has(B)){m++;break}}}return{length:m,isAmk:d,isNucleotide:p}}function m(e,r){var a=r.mask;var o=e.data.chains,s=o.residueStartIndex,l=o.residueEndIndex;var c=e.data.residues,m=c.atomStartIndex,d=c.atomEndIndex;var f=t.ChunkedArray.forInt32(r.atomCount);for(var h=0,v=e.data.chains.indices;h<v.length;h++){var B=v[h];var A=u(e,B,a),y=A.length,g=A.isAmk,C=A.isNucleotide;if(g&&y<=n||C&&y<=i)continue;for(var b=s[B],T=l[B];b<T;b++){if(!p(e,a,b))continue;for(var S=m[b],D=d[b];S<D;S++){if(a.has(S)){t.ChunkedArray.add(f,S)}}}}return t.ChunkedArray.compact(f)}function d(e,r,t,a,o,n,i){var s=false,l=false,c=false;for(var u=r;u<t;u++){if(!e.has(u))continue;var m=a[u];if(!s&&m===o){s=true}else if(!l&&m===n){l=true}if(s&&l)return true;if(m==="P"){c=true}}if(i)return s;return c}function p(e,r,t){var a=e.data,o=a.secondaryStructure,n=a.residues,i=a.atoms;var s=n.atomStartIndex,l=n.atomEndIndex,c=n.secondaryStructureIndex;var u=o[c[t]].type;if(u===0)return false;var m=i.name;if(u===5){return d(r,s[t],l[t],m,"O5'","C3'",false)}else{return d(r,s[t],l[t],m,"CA","O",true)}}})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(t){var a=this;var o=e.Bootstrap.Entity;var n=e.Bootstrap.Entity.Transformer;var i=e.Bootstrap.Tree;var s=e.Core.Structure.Query;t.ComplexInfo=o.create({name:"Macromolecular Complex Info",typeClass:"Object",shortName:"MC",description:"Information about a macromolecular complex."});t.CreateComplexInfo=i.Transformer.create({id:"complex-representation-create-info",name:"Complex Info",description:"Information about macromolecular complex (Main sequence, ligands, etc.).",from:[o.Molecule.Model,o.Molecule.Selection],to:[t.ComplexInfo],isUpdatable:false,defaultParams:function(){return{}}},function(o,n,i){return e.Bootstrap.Task.create("Complex","Normal",function(o){return __awaiter(a,void 0,void 0,function(){var a,s,l;return __generator(this,function(c){switch(c.label){case 0:a=e.Bootstrap.Utils.Molecule.findModel(n);s=e.Bootstrap.Utils.Molecule.findQueryContext(n);return[4,r.createComplexRepresentation(o,a.props.model,s)];case 1:l=c.sent();return[2,t.ComplexInfo.create(i,{label:"Complex",info:l})]}})})}).setReportTime(true)});t.CreateVisual=i.Transformer.actionWithContext({id:"complex-representation-create-visual",name:"Complex Visual",description:"Create a visual of a macromolecular complex.",from:[t.ComplexInfo],to:[o.Action],defaultParams:function(e){return{}}},function(t,a,o){var l=i.Transform.build();var c=a.props.info;if(c.sequence.all.length){var u=l.add(a,n.Basic.CreateGroup,{label:"Sequence",description:""},{isBinding:false});u.then(n.Molecule.CreateSelectionFromQuery,{query:s.atomsFromIndices(c.sequence.all),name:"All Residues",silent:true},{isBinding:false}).then(n.Molecule.CreateVisual,{style:e.Bootstrap.Visualization.Molecule.Default.ForType.get("Cartoons")},{});var m={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:true,vdwScaling:.21,bondRadius:.085,detail:"Automatic"},theme:{template:e.Bootstrap.Visualization.Molecule.Default.CartoonThemeTemplate,colors:e.Bootstrap.Visualization.Molecule.Default.CartoonThemeTemplate.colors,transparency:{alpha:1}}};if(c.sequence.interacting.length){u.then(n.Molecule.CreateSelectionFromQuery,{query:s.atomsFromIndices(c.sequence.interacting),name:"Interacting Residues",silent:true},{isBinding:false}).then(n.Molecule.CreateVisual,{style:m})}if(c.sequence.modified.length){u.then(n.Molecule.CreateSelectionFromQuery,{query:s.atomsFromIndices(c.sequence.modified),name:"Modified Residues",silent:true},{isBinding:false}).then(n.Molecule.CreateVisual,{style:m})}}if(c.het.other.length||c.het.carbohydrates.entries.length){var d=l.add(a,n.Basic.CreateGroup,{label:"HET",description:""},{isBinding:false});if(c.het.other.length){d.then(n.Molecule.CreateSelectionFromQuery,{query:s.atomsFromIndices(c.het.other),name:"Ligands",silent:true}).then(n.Molecule.CreateVisual,{style:e.Bootstrap.Visualization.Molecule.Default.ForType.get("BallsAndSticks")},{isBinding:false})}if(c.het.carbohydrates.entries.length){var p={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:false,atomRadius:.15,bondRadius:.07,detail:"Automatic"},theme:{template:e.Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate,colors:e.Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate.colors,transparency:{alpha:.15}}};var f=s.or(s.residuesFromIndices(c.het.carbohydrates.carbohydrateIndices),s.residuesFromIndices(c.het.carbohydrates.terminalIndices)).union();var h=d.then(e.Bootstrap.Entity.Transformer.Molecule.CreateSelectionFromQuery,{query:f,name:"Std. Carbohydrates",silent:true},{});h.then(e.Bootstrap.Entity.Transformer.Molecule.CreateVisual,{style:p});h.then(r.Carbohydrates.Transforms.CreateInfo,{info:c.het.carbohydrates}).then(r.Carbohydrates.Transforms.CreateVisual,r.Carbohydrates.DefaultFullParams,{isBinding:true})}}if(c.freeWaterAtoms.length){var v={type:"BallsAndSticks",params:{useVDW:false,atomRadius:.15,bondRadius:.07,detail:"Automatic"},theme:{template:e.Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate,colors:e.Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate.colors,transparency:{alpha:.2}}};l.add(a,n.Molecule.CreateSelectionFromQuery,{query:s.atomsFromIndices(c.freeWaterAtoms),name:"Unbound Water",silent:true},{isBinding:true}).then(n.Molecule.CreateVisual,{style:v},{})}return{action:l,context:{warnings:c.het.carbohydrates.warnings}}},function(e,r){if(!r)return;for(var t=0,a=r.warnings;t<a.length;t++){var o=a[t];e.logger.warning("Carbohydrates: "+o)}});t.SuppressCreateVisualWhenModelIsAdded=false;function l(r){e.Bootstrap.Event.Tree.NodeAdded.getStream(r).subscribe(function(a){if(t.SuppressCreateVisualWhenModelIsAdded||!e.Bootstrap.Tree.Node.is(a.data,e.Bootstrap.Entity.Molecule.Model)||a.data.isHidden){return}var o=e.Bootstrap.Tree.Transform.build().add(a.data,t.CreateComplexInfo,{}).then(t.CreateVisual,{},{isBinding:true});e.Bootstrap.Tree.Transform.apply(r,o).run().then(function(){e.Bootstrap.Command.Visual.ResetScene.dispatch(r,void 0)})})}t.CreateRepresentationWhenModelIsAddedBehaviour=l})(t=r.Transforms||(r.Transforms={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t;(function(t){"use strict";var a=e.Plugin.React;var o=e.Plugin.Controls;var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.updateVisual=function(e){var t=this.params;var a=e.type||t.type;this.autoUpdateParams(__assign({},a==="Full"?r.DefaultFullParams:r.DefaultIconsParams,t,e))};t.prototype.renderControls=function(){var e=this;var t=this.params;return a.createElement("div",null,a.createElement(o.Toggle,{onChange:function(r){return e.updateVisual({type:r?"Full":"Icons"})},value:t.type==="Full",label:"Links"}),t.type==="Full"?a.createElement(o.OptionsGroup,{options:r.FullSizes,caption:function(e){return e},current:t.fullSize,onChange:function(r){return e.updateVisual({fullSize:r})},label:"Size"}):a.createElement(o.Slider,{label:"Scale",onChange:function(r){return e.updateVisual({iconScale:r})},min:.5,max:1.1,step:.01,value:t.iconScale}),t.type==="Full"?a.createElement(o.ToggleColorPicker,{label:"Link Color",color:t.linkColor,onChange:function(r){return e.updateVisual({linkColor:r})}}):void 0,t.type==="Full"?a.createElement(o.Toggle,{onChange:function(r){return e.updateVisual({showTerminalLinks:r})},value:t.showTerminalLinks,label:"Terminal Links",title:"Show/hide link to non-carbohydrate residues"}):void 0,t.type==="Full"?a.createElement(o.Toggle,{onChange:function(r){return e.updateVisual({showTerminalAtoms:r})},value:t.showTerminalAtoms,label:"Terminal Pegs",title:"Show/hide terminal residues as spheres"}):void 0)};return t}(e.Plugin.Views.Transform.ControllerBase);t.CreateVisual=n})(t=r.UI||(r.UI={}))})(t=r.Carbohydrates||(r.Carbohydrates={}))})(t=r.ComplexReprensetation||(r.ComplexReprensetation={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2017 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){"use strict";var t=this;var a=e.Core.Geometry.LinearAlgebra.Vector3;var o=e.Bootstrap.Tree;var n=e.Bootstrap.Entity;r.Coloring=n.create({name:"Particle Coloring",typeClass:"Object",shortName:"PC",description:"Atom coloring based on distance from the molecule' centroid."});r.Apply=o.Transformer.create({id:"particle-coloring-apply",name:"Particle Coloring",description:"Apply atom coloring based on distance from the molecule' centroid.",from:[n.Molecule.Visual],to:[r.Coloring],isUpdatable:true,defaultParams:function(){return{min:0,max:1e10,steps:66,opacity:1}}},function(a,o,n){return e.Bootstrap.Task.create("Complex","Normal",function(s){return __awaiter(t,void 0,void 0,function(){var t,s,l;return __generator(this,function(u){t=e.Bootstrap.Utils.Molecule.findModel(o);s=i(t.props.model);l=r.Coloring.create(n,{info:s,label:"Particle Coloring",description:Math.round(10*n.params.min)/10+" - "+Math.round(10*n.params.max)/10});c(a,l,o,n.params);return[2,l]})})})},function(r,t,a){c(r,t,t.parent,a.params);return e.Bootstrap.Task.resolve(a.transformer.info.name,"Background",o.Node.Null)});function i(r){var t=r.positions,o=t.x,n=t.y,i=t.z,s=t.count;var l=a();e.Bootstrap.Utils.Molecule.getCentroidAndRadius(r,r.data.atoms.indices,l);var c=new Float32Array(s);var u=a();var m=1e20,d=0;for(var p=0;p<s;p++){a.set(u,o[p],n[p],i[p]);var f=a.distance(u,l);c[p]=f;if(f<m)m=f;else if(f>d)d=f}return{min:m,max:d,distances:c}}function s(e,r,t,a){var o=new Int32Array(e.length);var n=(t-r)/a;for(var i=0,s=e.length;i<s;i++){if(e[i]<r)o[i]=0;else if(e[i]>t)o[i]=a;else o[i]=Math.round((e[i]-r)/n)}return o}function l(r){var t=[];var a=e.Bootstrap.Visualization.Molecule.RainbowPalette;for(var o=r-1;o>=0;o--){var n=(a.length-1)*o/(r-1);var i=Math.floor(n),s=Math.min(Math.ceil(n),a.length-1);var l=e.Visualization.Color.fromRgb(0,0,0);e.Visualization.Color.interpolate(a[i],a[s],n-i,l);t.push(l)}return t}r.makeRainbow=l;function c(r,t,a,o){var n=o.min,i=o.max,c=o.steps,u=o.opacity;var m=t.props.info;var d=Math.ceil(c);var p=s(m.distances,Math.max(n,m.min),Math.min(i,m.max),d-1);var f=l(d);var h=e.Visualization.Theme.createPalleteIndexMapping(function(e){return p[e]},f);var v=e.Visualization.Theme.createMapping(h,{transparency:{alpha:u},isSticky:true});e.Bootstrap.Command.Visual.UpdateBasicTheme.dispatch(r,{visual:a,theme:v})}})(t=r.ParticleColoring||(r.ParticleColoring={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){"use strict";var t=e.Plugin.React;var a=e.Plugin.Controls;var o=function(r){__extends(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}o.prototype.rainbow=function(){var r="linear-gradient(to left,"+e.Bootstrap.Visualization.Molecule.RainbowPalette.map(function(e){return"rgb("+255*e.r+","+255*e.g+","+255*e.b+")"}).join(",")+")";return t.createElement("div",{style:{background:r,height:"8px",marginTop:"1px"}})};o.prototype.renderControls=function(){var e=this;var r=this.params;if(!this.isUpdate)return t.createElement("div",null);var o=this.controller.entity.props.info.max;var n=this.controller.entity.props.info.min;return t.createElement("div",null,this.rainbow(),t.createElement(a.Slider,{label:"Low Radius",onChange:function(r){return e.autoUpdateParams({min:r})},min:n,max:o,step:.1,value:Math.max(r.min,n)}),t.createElement(a.Slider,{label:"High Radius",onChange:function(r){return e.autoUpdateParams({max:r})},min:r.min,max:o,step:.1,value:Math.min(r.max,o)}),t.createElement(a.Slider,{label:"Opacity",onChange:function(r){return e.autoUpdateParams({opacity:r})},min:0,max:1,step:.01,value:r.opacity}))};return o}(e.Plugin.Views.Transform.ControllerBase);r.Apply=o})(t=r.UI||(r.UI={}))})(t=r.ParticleColoring||(r.ParticleColoring={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t=e.Plugin.React;var a=e.Plugin.Controls;var o=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.renderControls=function(){var e=this;var r=this.params;return t.createElement("div",null,t.createElement(a.TextBoxGroup,{value:r.server,onChange:function(r){return e.updateParams({server:r})},label:"Server",title:"The base URL of the annotation API.",onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter server URL..."}))};return r}(e.Plugin.Views.Transform.ControllerBase);r.CreateLoopAnnotationView=o})(t=r.RNALoops||(r.RNALoops={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t=this;var a=e.Bootstrap.Entity;var o=e.Bootstrap.Entity.Transformer;r.LoopAnnotation=a.create({name:"BGSU RNA Loops",typeClass:"Behaviour",shortName:"RL",description:"Represents BGSU loop annotation."});var n;(function(e){function r(e){var r=e.split("\n");var t=[];for(var a=0;a<r.length;a++){var o=r[a].trim();var n=o.indexOf(",");if(n<0)continue;var i=o.substring(1,n-2);var s=i[0]+i[1];var l=o.substring(n+2,o.length-1).split(",");var c=[];for(var u=0;u<l.length;u++){var m=l[u].split("|");c.push({modelId:m[1],authAsymId:m[2],authSeqNumber:+m[4],insCode:m[7]||""})}t.push({id:i,type:s,residues:c})}return t}e.parseCSV=r;function t(e){var r={};if(!e.length){return r}for(var t=0,a=e;t<a.length;t++){var o=a[t];for(var n=0,i=o.residues;n<i.length;n++){var s=i[n];var l=r[s.modelId]||(r[s.modelId]={});var c=l[s.authAsymId]||(l[s.authAsymId]={});var u=c[s.authSeqNumber]||(c[s.authSeqNumber]={});var m=u[s.insCode]||(u[s.insCode]=[]);m[m.length]=o}}return r}e.create=t;function a(e,r,t,a,o){var n=e[r];if(!n)return void 0;var i=n[t];if(!i)return void 0;var s=i[a];if(!s)return void 0;return s[o]}e.getEntries=a})(n=r.Api||(r.Api={}));var i;(function(r){var t=function(){function r(e,r){var t=this;this.context=e;this.annotation=r;this.provider=function(e){try{return t.processInfo(e)}catch(e){console.error("Error showing loop annotation label",e);return void 0}}}r.prototype.dispose=function(){this.context.highlight.removeProvider(this.provider)};r.prototype.register=function(e){this.context.highlight.addProvider(this.provider)};r.prototype.processInfo=function(r){var t=e.Bootstrap.Interactivity.Molecule.transformInteraction(r);if(!t||t.residues.length!==1)return void 0;var a=t.residues[0];var o=n.getEntries(this.annotation,t.modelId,a.chain.authAsymId,a.authSeqNumber,a.insCode||"");if(!o||!o.length)return void 0;return"RNA Loops: "+o.map(function(e){return"<b>"+e.type+"</b> ("+e.id+")"}).join(", ")};return r}();r.Behaviour=t})(i=r.Interactivity||(r.Interactivity={}));var s;(function(r){var t=function(){var r=e.Core.Utils.FastMap.create();r.set(0,{r:91/255,g:183/255,b:91/255});r.set(1,{r:73/255,g:175/255,b:205/255});r.set(2,{r:205/255,g:172/255,b:74/255});r.set(3,{r:.6,g:.6,b:.6});return r}();var a={r:.6,g:.6,b:.6};var o={r:0,g:0,b:1};var i={r:1,g:0,b:1};function s(e,r){var t=new Uint8Array(e.data.residues.count);var a=e.modelId;var o=e.data.residues,i=o.authAsymId,s=o.authSeqNumber,l=o.insCode;for(var c=0,u=e.data.residues.count;c<u;c++){var m=n.getEntries(r,a,i[c],s[c],l[c]||"");if(!m){t[c]=3;continue}var d=m[0];if(d.type==="IL")t[c]=0;else if(d.type==="HL")t[c]=1;else if(d.type==="J3")t[c]=2;else t[c]=3}return t}function l(e,r){var t=new Uint8Array(e.data.residues.count);var a=e.modelId;var o=e.parent;var i=e.data.residues,s=i.chainIndex,l=i.authSeqNumber,c=i.insCode;var u=e.data.chains.sourceChainIndex;var m=o.data.chains.authAsymId;for(var d=0,p=e.data.residues.count;d<p;d++){var f=m[u[s[d]]];var h=n.getEntries(r,a,f,l[d],c[d]||"");if(!h){t[d]=3;continue}var v=h[0];if(v.type==="IL")t[d]=0;else if(v.type==="HL")t[d]=1;else if(v.type==="J3")t[d]=2;else t[d]=3}return t}function c(r,n){var c=r.props.model;var u=c.source===e.Core.Structure.Molecule.Model.Source.File?s(c,n):l(c,n);var m=e.Core.Utils.FastMap.create();m.set("Uniform",a);m.set("Selection",o);m.set("Highlight",i);var d=c.data.atoms.residueIndex;var p=e.Visualization.Theme.createColorMapMapping(function(e){return u[d[e]]},t,a);return e.Visualization.Theme.createMapping(p,{colors:m,interactive:true,transparency:{alpha:1}})}r.create=c})(s||(s={}));var l=e.Bootstrap.Tree.Transformer.create({id:"rna-loops-create",name:"RNA Loops",description:"Create the RNA loop annotation object from a string.",from:[a.Data.String],to:[r.LoopAnnotation],defaultParams:function(){return{}}},function(a,o,s){return e.Bootstrap.Task.create("RNA Loop Annotation ("+s.params.id+")","Normal",function(e){return __awaiter(t,void 0,void 0,function(){var t,l;return __generator(this,function(c){switch(c.label){case 0:return[4,e.updateProgress("Parsing...")];case 1:c.sent();t=n.parseCSV(o.props.data);if(!t.length){throw new Error("No RNA loop annotation for '"+s.params.id+"' is available.")}l=n.create(t);return[2,r.LoopAnnotation.create(s,{label:"RNA Loop Annotation",behaviour:new i.Behaviour(a,l)})]}})})}).setReportTime(true)});r.DownloadAndCreate=e.Bootstrap.Tree.Transformer.actionWithContext({id:"rna-loops-download-and-create",name:"BGSU RNA Loop Annotation",description:"Download RNA loop annotation from BGSU",from:[a.Molecule.Molecule],to:[a.Action],defaultParams:function(e){return{server:e.settings.get("extensions.rnaLoops.defaultServer")}}},function(r,t,a){var n=t.props.molecule.id.trim().toLocaleUpperCase();var i=a.params.reportRef||e.Bootstrap.Utils.generateUUID();var s=e.Bootstrap.Tree.Transform.build().add(t,o.Data.Download,{url:a.params.server.replace("#id",n),type:"String",id:n,description:"Annotation Data",title:"RNA Annotation"}).then(l,{id:n},{isBinding:true,ref:i});return{action:s,context:{reportRef:i}}},function(e,r){if(!r||!e.select(r.reportRef).length){e.logger.error("Failed to load BGSU RNA annotation. Possible causes: no annotation available, server is down, server does not support HTTPS (use http:// in LiteMol URL to fix).");return}e.logger.info("BGSU RNA annotation loaded. Hovering over RNA residue will now contain loop info. To apply coloring, select the entity in the tree and apply it the right panel.")});r.ApplyTheme=e.Bootstrap.Tree.Transformer.create({id:"rna-loops-apply-theme",name:"Apply Coloring",description:"Colors RNA strands according to annotation of secondary structure loops.",from:[r.LoopAnnotation],to:[a.Action],defaultParams:function(){return{}}},function(r,a,o){return e.Bootstrap.Task.create("RNA Annotation Coloring","Background",function(o){return __awaiter(t,void 0,void 0,function(){var t,o,n,i,l,c,u,m;return __generator(this,function(d){t=e.Bootstrap.Tree.Node.findAncestor(a,e.Bootstrap.Entity.Molecule.Molecule);if(!t){throw"No suitable parent found."}o=e.Core.Utils.FastMap.create();n=r.select(e.Bootstrap.Tree.Selection.byValue(t).subtree().ofType(e.Bootstrap.Entity.Molecule.Visual));for(i=0,l=n;i<l.length;i++){c=l[i];u=e.Bootstrap.Utils.Molecule.findModel(c);if(!u)continue;m=o.get(u.id);if(!m){m=s.create(u,a.props.behaviour.annotation);o.set(u.id,m)}e.Bootstrap.Command.Visual.UpdateBasicTheme.dispatch(r,{visual:c,theme:m})}r.logger.message("RNA annotation coloring applied.");return[2,e.Bootstrap.Tree.Node.Null]})})})})})(t=r.RNALoops||(r.RNALoops={}))})(r=e.Extensions||(e.Extensions={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){"use strict";var t=e.Bootstrap;var a=t.Entity;var o=t.Entity.Transformer;r.DownloadMolecule=o.Molecule.downloadMoleculeSource({sourceId:"pdbe-molecule",name:"PDBe (mmCIF)",description:"Download a molecule from PDBe.",defaultId:"1cbs",specificFormat:e.Core.Formats.Molecule.SupportedFormats.mmCIF,urlTemplate:function(e){return"https://www.ebi.ac.uk/pdbe/static/entry/"+e.toLowerCase()+"_updated.cif"}});r.DownloadBinaryCIFFromCoordinateServer=t.Tree.Transformer.action({id:"molecule-download-bcif-from-coordinate-server",name:"Download Molecule",description:"Download full or cartoon representation of a PDB entry using the BinaryCIF format.",from:[a.Root],to:[a.Action],defaultParams:function(e){return{id:"1cbs",type:"Full",lowPrecisionCoords:true,serverUrl:e.settings.get("molecule.downloadBinaryCIFFromCoordinateServer.server")?e.settings.get("molecule.downloadBinaryCIFFromCoordinateServer.server"):"https://webchem.ncbr.muni.cz/CoordinateServer"}},validateParams:function(e){return!e.id||!e.id.trim().length?["Enter Id"]:!e.serverUrl||!e.serverUrl.trim().length?["Enter CoordinateServer base URL"]:void 0}},function(r,o,n){var i=n.params.type==="Cartoon"?"cartoon":"full";var s=n.params.id.toLowerCase().trim();var l=""+n.params.serverUrl+(n.params.serverUrl[n.params.serverUrl.length-1]==="/"?"":"/")+s+"/"+i+"?encoding=bcif&lowPrecisionCoords="+(n.params.lowPrecisionCoords?"1":"0");return t.Tree.Transform.build().add(o,a.Transformer.Data.Download,{url:l,type:"Binary",id:s,title:"Molecule"}).then(a.Transformer.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{isBinding:true}).then(a.Transformer.Molecule.CreateModel,{modelIndex:0},{isBinding:false})})})(t=r.Data||(r.Data={}))})(t=r.PDBe||(r.PDBe={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){"use strict";var t=e.Bootstrap;var a=t.Entity;var o=t.Entity.Transformer;var n=t.Tree;var i=t.Visualization;r.DensitySourceLabels={"electron-density":"X-ray (from PDB Id)","emdb-pdbid":"EMDB (from PDB Id)","emdb-id":"EMDB (from EMDB Id)"};r.DensitySources=["electron-density","emdb-pdbid","emdb-id"];function s(r,a,n){var s=t.Tree.Transform.build();n=n.trim().toLowerCase();var l=a.props.ref?a.props.ref:t.Utils.generateUUID();var c=s.add(r,o.Basic.CreateGroup,{label:n,description:"Density"},{ref:l});var u=t.Utils.generateUUID();var m=t.Utils.generateUUID();var d=c.then(o.Data.Download,{url:"https://www.ebi.ac.uk/pdbe/coordinates/files/"+n+"_diff.ccp4",type:"Binary",id:n,description:"Fo-Fc",title:"Density"}).then(o.Density.ParseData,{format:e.Core.Formats.Density.SupportedFormats.CCP4,id:"Fo-Fc"},{isBinding:true,ref:u});d.then(o.Density.CreateVisualBehaviour,{id:"Fo-Fc(-ve)",isoSigmaMin:-5,isoSigmaMax:0,minRadius:0,maxRadius:10,radius:5,showFull:false,style:i.Density.Style.create({isoValue:-3,isoValueType:t.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(12268339),isWireframe:true,transparency:{alpha:1}})});d.then(o.Density.CreateVisualBehaviour,{id:"Fo-Fc(+ve)",isoSigmaMin:0,isoSigmaMax:5,minRadius:0,maxRadius:10,radius:5,showFull:false,style:i.Density.Style.create({isoValue:3,isoValueType:t.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(3390259),isWireframe:true,transparency:{alpha:1}})});c.then(o.Data.Download,{url:"https://www.ebi.ac.uk/pdbe/coordinates/files/"+n+".ccp4",type:"Binary",id:n,description:"2Fo-Fc",title:"Density"}).then(o.Density.ParseData,{format:e.Core.Formats.Density.SupportedFormats.CCP4,id:"2Fo-Fc"},{isBinding:true,ref:m}).then(o.Density.CreateVisualBehaviour,{id:"2Fo-Fc",isoSigmaMin:0,isoSigmaMax:2,minRadius:0,maxRadius:10,radius:5,showFull:false,style:i.Density.Style.create({isoValue:1.5,isoValueType:t.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(3367602),isWireframe:false,transparency:{alpha:.4}})});return{action:s,context:{id:n,refs:[m,u],groupRef:l}}}function l(r,a,n,s){var l=t.Tree.Transform.build();var c=t.Utils.generateUUID();var u="EMD-"+n;l.add(r,o.Data.Download,{url:"https://www.ebi.ac.uk/pdbe/static/files/em/maps/emd_"+n+".map.gz",type:"Binary",id:u,description:"EMDB Density",responseCompression:t.Utils.DataCompressionMethod.Gzip,title:"Density"}).then(o.Density.ParseData,{format:e.Core.Formats.Density.SupportedFormats.CCP4,id:u},{isBinding:true,ref:c}).then(o.Density.CreateVisualBehaviour,{id:"Density",isoSigmaMin:-5,isoSigmaMax:5,minRadius:0,maxRadius:50,radius:5,showFull:false,style:i.Density.Style.create({isoValue:s!==void 0?s:1.5,isoValueType:s!==void 0?t.Visualization.Density.IsoValueType.Absolute:t.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(6524815),isWireframe:false,transparency:{alpha:.3}})});return{action:l,context:{id:n,refs:[c]}}}function c(e,r){return{action:t.Tree.Transform.build().add(e,o.Basic.Fail,{title:"Density",message:r}),context:void 0}}function u(e,r,a,o){return __awaiter(this,void 0,void 0,function(){var n,i,s,l,u;return __generator(this,function(d){switch(d.label){case 0:o=o.trim().toLowerCase();return[4,t.Utils.ajaxGetString("https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/"+o,"PDB API").run(e)];case 1:n=d.sent();try{i=JSON.parse(n);s=void 0;l=i[o];if(l&&l[0]&&l[0].related_structures){u=l[0].related_structures.filter(function(e){return e.resource==="EMDB"});if(!u.length){return[2,c(r,"No related EMDB entry found for '"+o+"'.")]}s=u[0].accession.split("-")[1]}else{return[2,c(r,"No related EMDB entry found for '"+o+"'.")]}return[2,m(e,r,a,s)]}catch(e){return[2,c(r,"PDBe API call failed.")]}return[2]}})})}function m(e,r,a,o){return __awaiter(this,void 0,void 0,function(){var n,i,s,u;return __generator(this,function(m){switch(m.label){case 0:o=o.trim();return[4,t.Utils.ajaxGetString("https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/EMD-"+o,"EMDB API").run(e)];case 1:n=m.sent();try{i=JSON.parse(n);s=void 0;u=i["EMD-"+o];if(u&&u[0]&&u[0].map&&u[0].map.contour_level&&u[0].map.contour_level.value!==void 0){s=+u[0].map.contour_level.value}return[2,l(r,a,o,s)]}catch(e){return[2,c(r,"EMDB API call failed.")]}return[2]}})})}r.DownloadDensity=t.Tree.Transformer.actionWithContext({id:"pdbe-density-download-data",name:"Density Data from PDBe",description:"Download density data from PDBe.",from:[a.Root],to:[a.Action],defaultParams:function(){return{sourceId:"electron-density",id:{"electron-density":"1cbs","emdb-id":"3121","emdb-pdbid":"5aco"}}},validateParams:function(e){var r=e.sourceId?e.sourceId:"electron-density";if(!e.id)return["Enter Id"];var t=typeof e.id==="string"?e.id:e.id[r];return!t.trim().length?["Enter Id"]:void 0}},function(e,r,t){var a;if(typeof t.params.id==="string")a=t.params.id;else a=t.params.id[t.params.sourceId];switch(t.params.sourceId||"electron-density"){case"electron-density":return s(r,t,a);case"emdb-id":return m(e,r,t,a);case"emdb-pdbid":return u(e,r,t,a);default:return c(r,"Unknown source.")}},function(e,r){if(!r)return;var a=r,o=a.id,i=a.refs,s=a.groupRef;var l=e.select((c=n.Selection).byRef.apply(c,i));if(l.length===i.length){e.logger.message("Density loaded, click on a residue or an atom to view the data.")}else if(l.length>0){e.logger.message("Density partially loaded, click on a residue or an atom to view the data.")}else{e.logger.error("Density for ID '"+o+"' failed to load.");if(s){t.Command.Tree.RemoveNode.dispatch(e,s)}}var c})})(t=r.Data||(r.Data={}))})(t=r.PDBe||(r.PDBe={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t=this;var a=e.Bootstrap.Entity;var o=e.Bootstrap.Entity.Transformer;r.Report=a.create({name:"PDBe Molecule Validation Report",typeClass:"Behaviour",shortName:"VR",description:"Represents PDBe validation report."});var n;(function(e){function r(e,r){var t=e.toString();if((r||"").length!==0&&r!==" ")t+=" "+r;return t}e.getResidueId=r;function t(e,r,t,a,o){var n=e[t];if(!n)return void 0;n=n[a];if(!n)return void 0;n=n[r];if(!n)return void 0;return n[o]}e.getEntry=t;function a(e){var t={};if(!e.molecules)return t;for(var a=0,o=e.molecules;a<o.length;a++){var n=o[a];var i=t[n.entity_id.toString()]||{};for(var s=0,l=n.chains;s<l.length;s++){var c=l[s];var u=i[c.struct_asym_id]||{};for(var m=0,d=c.models;m<d.length;m++){var p=d[m];var f=u[p.model_id.toString()]||{};for(var h=0,v=p.residues;h<v.length;h++){var B=v[h];var A=r(B.residue_number,B.author_insertion_code),y=f[A];if(y){y.residues.push(B);y.numIssues=Math.max(y.numIssues,B.outlier_types.length)}else{f[A]={residues:[B],numIssues:B.outlier_types.length}}}u[p.model_id.toString()]=f}i[c.struct_asym_id]=u}t[n.entity_id.toString()]=i}return t}e.createReport=a})(n=r.Api||(r.Api={}));var i;(function(r){var t=function(){function r(e,r){var t=this;this.context=e;this.report=r;this.provider=function(e){try{return t.processInfo(e)}catch(e){console.error("Error showing validation label",e);return void 0}}}r.prototype.dispose=function(){this.context.highlight.removeProvider(this.provider)};r.prototype.register=function(e){this.context.highlight.addProvider(this.provider)};r.prototype.processInfo=function(r){var t=e.Bootstrap.Interactivity.Molecule.transformInteraction(r);if(!t||t.residues.length!==1)return void 0;var a=t.residues[0];var o=n.getEntry(this.report,t.modelId,a.chain.entity.entityId,a.chain.asymId,n.getResidueId(a.seqNumber,a.insCode));if(!o)return void 0;var i;if(o.residues.length===1){var s=o.residues[0];i="Validation: ";if(!s.outlier_types.length)i+="no issue";else i+="<b>"+o.residues[0].outlier_types.join(", ")+"</b>";return i}else{i="";var l=0;for(var c=0,u=o.residues;c<u.length;c++){var m=u[c];if(l>0)i+=", ";i+="Validation (altLoc "+m.alt_code+"): <b>"+m.outlier_types.join(", ")+"</b>";l++}return i}};return r}();r.Behaviour=t})(i=r.Interactivity||(r.Interactivity={}));var s;(function(r){var t=function(){var r=e.Core.Utils.FastMap.create();r.set(0,{r:0,g:1,b:0});r.set(1,{r:1,g:1,b:0});r.set(2,{r:1,g:.5,b:0});r.set(3,{r:1,g:0,b:0});r.set(4,{r:.7,g:.7,b:.7});return r}();var a={r:.6,g:.6,b:.6};var o={r:0,g:0,b:1};var i={r:1,g:0,b:1};function s(e,r){var t=new Uint8Array(e.data.residues.count);var a=e.modelId;var o=e.data.residues,i=o.asymId,s=o.entityId,l=o.seqNumber,c=o.insCode,u=o.isHet;for(var m=0,d=e.data.residues.count;m<d;m++){var p=n.getEntry(r,a,s[m],i[m],n.getResidueId(l[m],c[m]));if(p){t[m]=Math.min(p.numIssues,3)}else if(u[m]){t[m]=4}}return t}function l(e,r){var t=new Uint8Array(e.data.residues.count);var a=e.modelId;var o=e.parent;var i=e.data.residues,s=i.entityId,l=i.seqNumber,c=i.insCode,u=i.chainIndex,m=i.isHet;var d=e.data.chains.sourceChainIndex;var p=o.data.chains.asymId;for(var f=0,h=e.data.residues.count;f<h;f++){var v=p[d[u[f]]];var B=n.getEntry(r,a,s[f],v,n.getResidueId(l[f],c[f]));if(B){t[f]=Math.min(B.numIssues,3)}else if(m[f]){t[f]=4}}return t}function c(r,n){var c=r.props.model;var u=c.source===e.Core.Structure.Molecule.Model.Source.File?s(c,n):l(c,n);var m=e.Core.Utils.FastMap.create();m.set("Uniform",a);m.set("Selection",o);m.set("Highlight",i);var d=c.data.atoms.residueIndex;var p=e.Visualization.Theme.createColorMapMapping(function(e){return u[d[e]]},t,a);return e.Visualization.Theme.createMapping(p,{colors:m,interactive:true,transparency:{alpha:1}})}r.create=c})(s||(s={}));var l=e.Bootstrap.Tree.Transformer.create({id:"pdbe-validation-create",name:"PDBe Validation",description:"Create the validation report from a string.",from:[a.Data.String],to:[r.Report],defaultParams:function(){return{}}},function(a,o,s){return e.Bootstrap.Task.create("Validation Report ("+s.params.id+")","Normal",function(e){return __awaiter(t,void 0,void 0,function(){var t,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.updateProgress("Parsing...")];case 1:u.sent();t=JSON.parse(o.props.data);l=t[s.params.id];c=n.createReport(l||{});return[2,r.Report.create(s,{label:"Validation Report",behaviour:new i.Behaviour(a,c)})]}})})}).setReportTime(true)});r.DownloadAndCreate=e.Bootstrap.Tree.Transformer.action({id:"pdbe-validation-download-and-create",name:"PDBe Validation Report",description:"Download Validation Report from PDBe",from:[a.Molecule.Molecule],to:[a.Action],defaultParams:function(){return{}}},function(r,t,a){var n=t.props.molecule.id.trim().toLocaleLowerCase();var i=e.Bootstrap.Tree.Transform.build().add(t,o.Data.Download,{url:"https://www.ebi.ac.uk/pdbe/api/validation/residuewise_outlier_summary/entry/"+n,type:"String",id:n,description:"Validation Data",title:"Validation"}).then(l,{id:n},{isBinding:true,ref:a.params.reportRef});return i},"Validation report loaded. Hovering over residue will now contain validation info. To apply validation coloring, select the entity in the tree and apply it the right panel.");r.ApplyTheme=e.Bootstrap.Tree.Transformer.create({id:"pdbe-validation-apply-theme",name:"Apply Coloring",description:"Colors all visuals using the validation report.",from:[r.Report],to:[a.Action],defaultParams:function(){return{}}},function(r,a,o){return e.Bootstrap.Task.create("Validation Coloring","Background",function(o){return __awaiter(t,void 0,void 0,function(){var t,o,n,i,l,c,u,m;return __generator(this,function(d){t=e.Bootstrap.Tree.Node.findAncestor(a,e.Bootstrap.Entity.Molecule.Molecule);if(!t){throw"No suitable parent found."}o=e.Core.Utils.FastMap.create();n=r.select(e.Bootstrap.Tree.Selection.byValue(t).subtree().ofType(e.Bootstrap.Entity.Molecule.Visual));for(i=0,l=n;i<l.length;i++){c=l[i];u=e.Bootstrap.Utils.Molecule.findModel(c);if(!u)continue;m=o.get(u.id);if(!m){m=s.create(u,a.props.behaviour.report);o.set(u.id,m)}e.Bootstrap.Command.Visual.UpdateBasicTheme.dispatch(r,{visual:c,theme:m})}r.logger.message("Validation coloring applied.");return[2,e.Bootstrap.Tree.Node.Null]})})})})})(t=r.Validation||(r.Validation={}))})(t=r.PDBe||(r.PDBe={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(r){var t=this;var a=e.Bootstrap.Entity;var o=e.Bootstrap.Entity.Transformer;var n=e.Core.Structure.Query;r.Annotations=a.create({name:"PDBe Sequence Annotations",typeClass:"Data",shortName:"SA",description:"Represents PDBe sequence annotation data."});r.Annotation=a.create({name:"PDBe Sequence Annotation",typeClass:"Object",shortName:"SA",description:"Represents PDBe sequence annotation."},{isSilent:true,isFocusable:true});r.Behaviour=a.create({name:"PDBe Sequence Annotation Behaviour",typeClass:"Behaviour",shortName:"SA",description:"Represents PDBe sequence annoation behaviour."});var i;(function(t){var a=function(){function t(r){var t=this;this.context=r;this.node=void 0;this.current=void 0;this.subs=[];this.toHighlight=void 0;this.isHighlightOn=false;this.__highlight=e.Core.Utils.debounce(function(){return t.highlight()},33)}t.prototype.dispose=function(){this.resetTheme();for(var e=0,r=this.subs;e<r.length;e++){var t=r[e];t.dispose()}this.subs=[];this.node=void 0};t.prototype.register=function(t){var a=this;this.node=t;this.subs.push(this.context.behaviours.currentEntity.subscribe(function(e){return a.update(e)}));this.subs.push(e.Bootstrap.Command.Entity.Highlight.getStream(this.context).subscribe(function(e){if(e.data.entities.length===1){var t=e.data.entities[0];if(t.type!==r.Annotation)return;a.toHighlight=t;a.isHighlightOn=e.data.isOn;a.__highlight()}}));this.subs.push(e.Bootstrap.Command.Entity.Focus.getStream(this.context).subscribe(function(e){if(e.data.length===1){var t=e.data[0];if(t.type!==r.Annotation)return;a.focus(t)}}))};Object.defineProperty(t.prototype,"molecule",{get:function(){return e.Bootstrap.Utils.Molecule.findMolecule(this.node)},enumerable:true,configurable:true});t.prototype.resetTheme=function(){var r=this.molecule;if(r){e.Bootstrap.Command.Visual.ResetTheme.dispatch(this.context,{selection:e.Bootstrap.Tree.Selection.byValue(r).subtree()})}};t.prototype.getCached=function(e,r){return this.context.entityCache.get(e,"theme-"+r.id)};t.prototype.setCached=function(e,r,t){this.context.entityCache.set(e,"theme-"+r.id,t)};t.prototype.highlight=function(){var e=this.toHighlight;this.toHighlight=void 0;if(!e||e.type!==r.Annotation)return;var t=e;if(!this.isHighlightOn){if(this.current){this.update(this.current)}else{this.resetTheme()}}else{this.apply(t)}};t.prototype.focus=function(r){var t=this.molecule;if(!t)return;var a=this.context.select(e.Bootstrap.Tree.Selection.byValue(t).subtree().ofType(e.Bootstrap.Entity.Molecule.Model))[0];if(!a)return;e.Bootstrap.Command.Molecule.FocusQuery.dispatch(this.context,{model:a,query:r.props.query});e.Bootstrap.Command.Entity.SetCurrent.dispatch(this.context,r)};t.prototype.apply=function(r){var t=this.molecule;if(!t)return;var a=this.context.select(e.Bootstrap.Tree.Selection.byValue(t).subtree().ofType(e.Bootstrap.Entity.Molecule.Visual));for(var o=0,n=a;o<n.length;o++){var i=n[o];var l=e.Bootstrap.Utils.Molecule.findModel(i);if(!l)continue;var c=this.getCached(r,l);if(!c){c=s.create(l,r.props.query,r.props.color);this.setCached(r,l,c)}e.Bootstrap.Command.Visual.UpdateBasicTheme.dispatch(this.context,{visual:i,theme:c})}};t.prototype.update=function(e){if(!e||e.type!==r.Annotation){if(this.current)this.resetTheme();this.current=void 0;return}this.current=e;this.apply(this.current)};return t}();t.Behaviour=a})(i=r.Interactivity||(r.Interactivity={}));var s;(function(r){var t={r:1,g:1,b:1};var a=e.Visualization.Theme.Default.SelectionColor;var o=e.Visualization.Theme.Default.HighlightColor;function i(e,r){var t=new Uint8Array(e.data.residues.count);var a=e.data.atoms.residueIndex;for(var o=0,n=r.fragments;o<n.length;o++){var i=n[o];for(var s=0,l=i.atomIndices;s<l.length;s++){var c=l[s];t[a[c]]=1}}return t}function s(r,s,l){var c=r.props.model;var u=n.Builder.toQuery(s);var m=u(c.queryContext);var d=i(c,m);var p=e.Core.Utils.FastMap.create();p.set("Uniform",t);p.set("Bond",t);p.set("Selection",a);p.set("Highlight",o);var f=e.Core.Utils.FastMap.create();f.set(1,l);var h=c.data.atoms.residueIndex;var v=e.Visualization.Theme.createColorMapMapping(function(e){return d[h[e]]},f,t);return e.Visualization.Theme.createMapping(v,{colors:p,interactive:true,transparency:{alpha:1}})}r.create=s})(s||(s={}));function l(t,a,n){var i=e.Bootstrap.Tree.Transform.build();if(!n){return i}var s=e.Visualization.Color.fromHex(16410880);var l=function(e){var a=n[e];if(!a)return"continue";var l=Object.keys(a).filter(function(e){return Object.prototype.hasOwnProperty.call(a,e)});if(!l.length)return"continue";var c=i.add(t,o.Basic.CreateGroup,{label:e,isCollapsed:true},{isBinding:true});for(var u=0,m=l;u<m.length;u++){var d=m[u];c.then(r.CreateSingle,{data:a[d],id:d,color:s})}};for(var c=0,u=["Pfam","InterPro","CATH","SCOP","UniProt"];c<u.length;c++){var d=u[c];l(d)}i.add(t,m,{},{isHidden:true});return i}function c(e){if(e.length===0)return null;return e}r.CreateSingle=e.Bootstrap.Tree.Transformer.create({id:"pdbe-sequence-annotations-create-single",name:"PDBe Sequence Annotation",description:"Create a sequence annotation object.",from:[],to:[r.Annotation],defaultParams:function(){return{}},isUpdatable:true},function(a,o,i){return e.Bootstrap.Task.create("Sequence Annotation","Background",function(e){return __awaiter(t,void 0,void 0,function(){var e,t;return __generator(this,function(a){e=i.params.data;t=n.or.apply(null,e.mappings.map(function(e){return n.sequence(e.entity_id.toString(),e.struct_asym_id,{seqNumber:e.start.residue_number,insCode:c(e.start.author_insertion_code)},{seqNumber:e.end.residue_number,insCode:c(e.end.author_insertion_code)})})).union();return[2,r.Annotation.create(i,{label:e.identifier,description:i.params.id,query:t,color:i.params.color})]})})})});var u=e.Bootstrap.Tree.Transformer.create({id:"pdbe-sequence-annotations-parse",name:"PDBe Sequence Annotations",description:"Parse sequence annotation JSON.",from:[a.Data.String],to:[r.Annotations],defaultParams:function(){return{}}},function(a,o,n){return e.Bootstrap.Task.create("Sequence Annotations","Normal",function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(a){switch(a.label){case 0:return[4,e.updateProgress("Parsing...")];case 1:a.sent();t=JSON.parse(o.props.data);return[2,r.Annotations.create(n,{label:"Sequence Annotations",data:t})]}})})}).setReportTime(true)});var m=e.Bootstrap.Tree.Transformer.create({id:"pdbe-sequence-annotations-create-behaviour",name:"PDBe Sequence Annotation Behaviour",description:"Create sequence annotation behaviour.",from:[r.Annotations],to:[r.Behaviour],defaultParams:function(){return{}}},function(t,a,o){return e.Bootstrap.Task.resolve("Sequence Annotations","Background",r.Behaviour.create(o,{label:"Sequence Annotations",behaviour:new i.Behaviour(t)}))});var d=e.Bootstrap.Tree.Transformer.action({id:"pdbe-sequence-annotations-build",name:"PDBe Sequence Annotations",description:"Build sequence validations behaviour.",from:[r.Annotations],to:[a.Action],defaultParams:function(){return{}}},function(e,r,t){var a=r.props.data;var o=Object.keys(a);return l(r,o[0],a[o[0]])},"Sequence annotations downloaded. Selecting or hovering an annotation in the tree will color the visuals.");r.DownloadAndCreate=e.Bootstrap.Tree.Transformer.action({id:"pdbe-sequence-annotations-download-and-create",name:"PDBe Sequence Annotations",description:"Download Sequence Annotations from PDBe",from:[a.Molecule.Molecule],to:[a.Action],defaultParams:function(){return{}}},function(r,t,a){var n=t.props.molecule.id.trim().toLocaleLowerCase();return e.Bootstrap.Tree.Transform.build().add(t,o.Data.Download,{url:"https://www.ebi.ac.uk/pdbe/api/mappings/"+n,type:"String",id:n,description:"Annotation Data",title:"Annotation"}).then(u,{},{isBinding:true}).then(d,{},{isBinding:true})})})(t=r.SequenceAnnotation||(r.SequenceAnnotation={}))})(t=r.PDBe||(r.PDBe={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(r){var t;(function(t){var a=e.Plugin.React;var o=e.Plugin.Controls;var n=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.renderControls=function(){var e=this;var r=this.params;return a.createElement("div",null,a.createElement(o.ToggleColorPicker,{label:"Color",color:r.color,onChange:function(r){return e.controller.autoUpdateParams({color:r})},position:"below"}))};return r}(e.Plugin.Views.Transform.ControllerBase);t.CreateSequenceAnnotationView=n;var i=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.renderControls=function(){var e=this;var r=this.getPersistentState("showDetails",false);var t=this.params;var n=a.createElement(o.TextBoxGroup,{value:t.id,onChange:function(r){return e.updateParams({id:r})},label:"Id",onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter pdb id..."});var i=[a.createElement(o.OptionsGroup,{options:["Cartoon","Full"],caption:function(e){return e},current:t.type,onChange:function(r){return e.updateParams({type:r})},label:"Type",title:"Determines whether to send all atoms or just atoms that are needed for the Cartoon representation."}),a.createElement(o.Toggle,{onChange:function(r){return e.updateParams({lowPrecisionCoords:r})},value:t.lowPrecisionCoords,label:"Low Precicion",title:"If on, sends coordinates with 1 digit precision instead of 3. This saves up to 50% of data that need to be sent."}),a.createElement(o.TextBoxGroup,{value:t.serverUrl,onChange:function(r){return e.updateParams({serverUrl:r})},label:"Server",title:"The base URL of the CoordinateServer.",onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter server URL..."})];return a.createElement(o.ExpandableGroup,{select:n,expander:a.createElement(o.ControlGroupExpander,{isExpanded:r,onChange:function(r){return e.setPersistentState("showDetails",r)}}),options:i,isExpanded:r})};return r}(e.Plugin.Views.Transform.ControllerBase);t.DownloadBinaryCIFFromCoordinateServerView=i;var s=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.prototype.getId=function(){var e=this.params.id;if(!e)return"";if(typeof e==="string")return e;return e[this.params.sourceId]};n.prototype.updateId=function(r){var t=this.params;var a=t.id;if(!a||typeof a==="string")a=(o={},o[t.sourceId]=r,o);else a=e.Bootstrap.Utils.merge(a,(n={},n[t.sourceId]=r,n));this.updateParams({id:a});var o,n};n.prototype.renderControls=function(){var e=this;var t=this.params;var n=t.sourceId==="emdb-id"?"EMDB Id":"PDB Id";return a.createElement("div",null,a.createElement(o.OptionsGroup,{options:r.Data.DensitySources,caption:function(e){return r.Data.DensitySourceLabels[e]},current:t.sourceId,onChange:function(r){return e.updateParams({sourceId:r})},label:"Source",title:"Determines where to obtain the data."}),a.createElement(o.TextBoxGroup,{value:this.getId(),onChange:function(r){return e.updateId(r)},label:n,onEnter:function(r){return e.applyEnter(r)},placeholder:"Enter id..."}))};return n}(e.Plugin.Views.Transform.ControllerBase);t.DownloadDensityView=s})(t=r.Views||(r.Views={}))})(t=r.PDBe||(r.PDBe={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(t){"use strict";var a=e.Plugin.React;var o=e.Plugin.Controls;var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.renderControls=function(){var e=this;var t=this.params.exampleId;return a.createElement(o.OptionsGroup,{options:r.Examples.ExampleIds,caption:function(e){return r.Examples.ExampleMap[e].name},current:t,onChange:function(r){return e.updateParams({exampleId:r})},label:"Name"})};return t}(e.Plugin.Views.Transform.ControllerBase);t.LoadExample=n;var i=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.prototype.updateSourceParams=function(e){var r=this.params;var t=r.sources[r.sourceKind];var a={sources:__assign({},r.sources,(o={},o[r.sourceKind]=__assign({},t,e),o))};this.updateParams(a);var o};n.prototype.coordServer=function(e){var r=this;if(e.kind!=="CoordinateServer")return[];var t=this.getPersistentState("showDetails",false);var n=e;var i=a.createElement(o.TextBoxGroup,{value:n.id,onChange:function(e){return r.updateSourceParams({id:e})},label:"Id",onEnter:function(e){return r.applyEnter(e)},placeholder:"Enter pdb id..."});var s=[a.createElement(o.OptionsGroup,{options:["Cartoon","Full"],caption:function(e){return e},current:n.type,onChange:function(e){return r.updateSourceParams({type:e})},label:"Type",title:"Determines whether to send all atoms or just atoms that are needed for the Cartoon representation."}),a.createElement(o.Toggle,{onChange:function(e){return r.updateSourceParams({lowPrecisionCoords:e})},value:n.lowPrecisionCoords,label:"Low Precicion",title:"If on, sends coordinates with 1 digit precision instead of 3. This saves up to 50% of data that need to be sent."}),a.createElement(o.TextBoxGroup,{value:n.serverUrl,onChange:function(e){return r.updateSourceParams({serverUrl:e})},label:"Server",title:"The base URL of the CoordinateServer.",onEnter:function(e){return r.applyEnter(e)},placeholder:"Enter server URL..."})];return a.createElement(o.ExpandableGroup,{select:i,expander:a.createElement(o.ControlGroupExpander,{isExpanded:t,onChange:function(e){return r.setPersistentState("showDetails",e)}}),options:s,isExpanded:t})};n.prototype.PDBe=function(e){var r=this;if(e.kind!=="PDBe Updated mmCIF")return[];return a.createElement(o.TextBoxGroup,{value:e.id,onChange:function(e){return r.updateSourceParams({id:e})},label:"Id",onEnter:function(e){return r.applyEnter(e)},placeholder:"Enter pdb id..."})};n.prototype.url=function(r){var t=this;if(r.kind!=="URL")return[];return[a.createElement(o.OptionsGroup,{options:e.Core.Formats.Molecule.SupportedFormats.All,caption:function(e){return e.name},current:r.format,onChange:function(e){return t.updateSourceParams({format:e})},label:"Format"}),a.createElement(o.TextBoxGroup,{value:r.url,onChange:function(e){return t.updateSourceParams({url:e})},label:"URL",onEnter:function(e){return t.applyEnter(e)},placeholder:"Enter pdb id..."})]};n.prototype.file=function(r){var t=this;if(r.kind!=="File on Disk")return[];var o=this.controller.latestState;var n=e.Core.Formats.FormatInfo.formatFileFilters(e.Core.Formats.Molecule.SupportedFormats.All);return a.createElement("div",null,a.createElement("div",{className:"lm-btn lm-btn-block lm-btn-action lm-loader-lm-btn-file",style:{marginTop:"1px"}},r.file?r.file.name:"Select a file..."," ",a.createElement("input",{disabled:o.isBusy,type:"file",accept:n,onChange:function(e){return t.updateSourceParams({file:e.target.files[0]})},multiple:false})))};n.prototype.renderControls=function(){var e=this;var t=this.params;var n=t.sources[t.sourceKind];var i=t.sourceKind==="CoordinateServer"?this.coordServer(n):t.sourceKind==="PDBe Updated mmCIF"?this.PDBe(n):t.sourceKind==="URL"?this.url(n):this.file(n);return a.createElement("div",null,a.createElement(o.OptionsGroup,{options:r.DataSources.ObtainDownloadSources,caption:function(e){return e},current:t.sourceKind,onChange:function(r){return e.updateParams({sourceKind:r})},label:"Source",title:"Determines where to obtain the data."}),i)};return n}(e.Plugin.Views.Transform.ControllerBase);t.ObtainDownload=i})(t=r.Views||(r.Views={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t;(function(t){var a=e.Bootstrap.Entity.Transformer;var o=e.Bootstrap.Visualization;t.ExampleMap={"zika-cryo-em":{name:"Zika Virus + Cryo-EM Map",provider:l},"5va1-cryo-em":{name:"Open Human Ether-a-go-go-Related K(+) Channel hERG + Cryo-EM Map",provider:c},"3a4x-lig":{name:"PDB ID 3A4X Ligand Validation",provider:d},"hiv1-protease":{name:"HIV-1 Protease + PDBe Validation + X-ray Density",provider:m},"hiv1-capsid":{name:"HIV-1 Capsid Cartoon Model",provider:u}};t.ExampleIds=Object.getOwnPropertyNames(t.ExampleMap);t.LoadExample=e.Bootstrap.Tree.Transformer.action({id:"viewer-load-example",name:"Examples",description:"Clears the scene and loads the selected example",from:[e.Bootstrap.Entity.Root],to:[e.Bootstrap.Entity.Action],defaultParams:function(){return{exampleId:t.ExampleIds[0]}}},function(r,o,n){e.Bootstrap.Command.Tree.RemoveNode.dispatch(r,r.tree.root);var i=t.ExampleMap[n.params.exampleId];if(i)i.provider(new e.Plugin.Controller(r.plugin));var s=n.params.exampleId==="hiv1-capsid"?1e4:2500;return e.Bootstrap.Tree.Transform.build().add(o,a.Basic.Delay,{timeoutMs:s})});function n(e){if(document.body.clientWidth<825)e.setLayoutState({hideControls:true})}function i(r,t,a,o){var n=t();var i=r.subscribe(e.Bootstrap.Event.Tree.NodeRemoved,function(e){if(!i||!n||e.data.ref!==a)return;n.dispose();n=void 0;if(i){i.dispose();i=void 0}if(o)o()})}function s(r){e.Extensions.ComplexReprensetation.Transforms.SuppressCreateVisualWhenModelIsAdded=r;e.Bootstrap.Behaviour.SuppressCreateVisualWhenModelIsAdded=r}function l(r){s(true);n(r);var t=r.createTransform().add(r.root,a.Data.Download,{url:"https://webchem.ncbr.muni.cz/CoordinateServer/5ire/full?encoding=bcif&lowPrecisionCoords=1",type:"Binary",id:"5ire"}).then(a.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{ref:"molecule",isBinding:true});r.applyTransform(t).then(function(){var t=r.createTransform().add("molecule",a.Molecule.CreateModel,{modelIndex:0}).then(a.Molecule.CreateAssembly,{name:"1"}).then(a.Molecule.CreateMacromoleculeVisual,{het:true,polymer:true,water:false,hetRef:"het",polymerRef:"polymer"},{});r.applyTransform(t).then(function(){s(false);var t={template:o.Molecule.Default.UniformThemeTemplate,colors:o.Molecule.Default.UniformThemeTemplate.colors.set("Uniform",e.Visualization.Color.fromHex(49135))};r.context.transforms.getController(a.Molecule.CreateVisual,r.selectEntities("polymer")[0]).updateStyleTheme(t);r.context.transforms.getController(a.Molecule.CreateVisual,r.selectEntities("het")[0]).updateStyleTheme(t);var n=r.selectEntities("5ire_density_streaming")[0];if(n){r.command(e.Bootstrap.Command.Entity.SetCurrent,n)}}).catch(function(){return s(false)});var n={server:"https://webchem.ncbr.muni.cz/DensityServer/",id:"5ire",source:"EM",initialStreamingParams:{EM:o.Density.Style.create({isoValue:3,isoValueType:o.Density.IsoValueType.Absolute,color:e.Visualization.Color.fromHex(10066329),isWireframe:false,transparency:{alpha:.2},taskType:"Background"}),isoValues:{EM:3},detailLevel:4},streamingEntityRef:"5ire_density_streaming"};var i=r.createTransform().add("molecule",e.Extensions.DensityStreaming.Setup,n);r.applyTransform(i)})}function c(r){s(true);n(r);var t=r.createTransform().add(r.root,a.Data.Download,{url:"https://webchem.ncbr.muni.cz/CoordinateServer/5va1/full?encoding=bcif&lowPrecisionCoords=1",type:"Binary",id:"5va1"}).then(a.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{ref:"molecule",isBinding:true});r.applyTransform(t).then(function(){var t=r.createTransform().add("molecule",a.Molecule.CreateModel,{modelIndex:0}).then(a.Molecule.CreateAssembly,{name:"1"}).then(a.Molecule.CreateMacromoleculeVisual,{het:true,polymer:true,water:false,hetRef:"het",polymerRef:"polymer"},{});r.applyTransform(t).then(function(){s(false);var t={template:o.Molecule.Default.RainbowEntityThemeTemplate};r.context.transforms.getController(a.Molecule.CreateVisual,r.selectEntities("polymer")[0]).updateStyleTheme(t);var n=r.selectEntities("5va1_density_streaming")[0];if(n){r.command(e.Bootstrap.Command.Entity.SetCurrent,n)}}).catch(function(){return s(false)});var n={server:"https://webchem.ncbr.muni.cz/DensityServer/",id:"5va1",source:"EM",initialStreamingParams:{detailLevel:4},streamingEntityRef:"5va1_density_streaming"};var i=r.createTransform().add("molecule",e.Extensions.DensityStreaming.Setup,n);r.applyTransform(i)})}function u(r){s(true);n(r);var t=r.createTransform().add(r.root,a.Data.Download,{url:"https://webchem.ncbr.muni.cz/CoordinateServer/3j3q/cartoon?encoding=bcif&lowPrecisionCoords=1",type:"Binary",id:"3j3q"}).then(a.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{ref:"molecule",isBinding:true}).then(a.Molecule.CreateModel,{modelIndex:0}).then(a.Molecule.CreateMacromoleculeVisual,{het:true,polymer:true,water:false,polymerRef:"polymer"},{});r.applyTransform(t).then(function(){s(false);var e={template:o.Molecule.Default.RainbowEntityThemeTemplate};r.context.transforms.getController(a.Molecule.CreateVisual,r.selectEntities("polymer")[0]).updateStyleTheme(e)}).catch(function(){return s(false)});return t}function m(t){return __awaiter(this,void 0,void 0,function(){function o(){var e=t.createTransform().add("hiv1-validation",r.PDBe.Validation.ApplyTheme,{});return t.applyTransform(e)}var l,c,u,m,d,p;return __generator(this,function(f){switch(f.label){case 0:s(true);n(t);l="hiv1-protease-data";c=t.createTransform().add(t.root,a.Data.Download,{url:"https://webchem.ncbr.muni.cz/CoordinateServer/2f80/full?encoding=bcif&lowPrecisionCoords=1",type:"Binary",id:"2f80"},{ref:l}).then(a.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{ref:"molecule",isBinding:true}).then(a.Molecule.CreateModel,{modelIndex:0}).then(a.Molecule.CreateMacromoleculeVisual,{het:true,polymer:true,water:false,hetRef:"het-visual",polymerRef:"polymer-visual"},{});return[4,t.applyTransform(c)];case 1:f.sent();s(false);t.command(e.Bootstrap.Command.Molecule.CreateSelectInteraction,{entity:t.selectEntities("het-visual")[0],query:e.Core.Structure.Query.atomsById(1625)});t.command(e.Bootstrap.Command.Entity.Focus,t.selectEntities("polymer-visual"));u=t.createTransform().add("molecule",r.PDBe.Validation.DownloadAndCreate,{reportRef:"hiv1-validation"});m=t.applyTransform(u);d={server:"https://webchem.ncbr.muni.cz/DensityServer/",id:"2f80",source:"X-ray",initialStreamingParams:{radius:1.5,"2Fo-Fc":e.Bootstrap.Visualization.Density.Style.create({isoValue:1.5,isoValueType:e.Bootstrap.Visualization.Density.IsoValueType.Sigma,color:e.Visualization.Color.fromHex(3367602),isWireframe:true,transparency:{alpha:.4},taskType:"Background"})}};p=t.createTransform().add("molecule",e.Extensions.DensityStreaming.Setup,d);t.applyTransform(p);return[4,m];case 2:f.sent();setTimeout(function(){return o()},50);i(t,function(){return t.subscribe(e.Bootstrap.Command.Visual.ResetScene,function(){return setTimeout(function(){return o()},25)})},l);return[2]}})})}function d(t){return __awaiter(this,void 0,void 0,function(){function l(){var e=t.createTransform().add("validation",r.ValidatorDB.ApplyTheme,{});t.applyTransform(e)}var c,u,m,d,p,f,h,v,B;return __generator(this,function(A){switch(A.label){case 0:s(true);e.Bootstrap.Behaviour.Molecule.SuppressShowInteractionOnSelect=true;n(t);c={type:"BallsAndSticks",taskType:"Background",params:{useVDW:false,atomRadius:.14,bondRadius:.08,detail:"Automatic"},theme:{template:o.Molecule.Default.UniformThemeTemplate,colors:o.Molecule.Default.UniformThemeTemplate.colors.set("Uniform",{r:.4,g:.4,b:.4}),transparency:{alpha:1}}};u={type:"BallsAndSticks",taskType:"Background",params:{useVDW:false,atomRadius:.3,bondRadius:.12,detail:"Automatic"},theme:{template:o.Molecule.Default.UniformThemeTemplate,colors:o.Molecule.Default.UniformThemeTemplate.colors.set("Uniform",{r:.4,g:.4,b:.4}),transparency:{alpha:1}}};m="3a4x-ligint-data";d=e.Core.Structure.Query.residues({entityId:"2",authAsymId:"B",authSeqNumber:2});p=t.createTransform().add(t.root,a.Data.Download,{url:"https://webchem.ncbr.muni.cz/CoordinateServer/3a4x/ligandInteraction?modelId=1&entityId=2&authAsymId=B&authSeqNumber=2&insCode=&radius=5&atomSitesOnly=1&encoding=bcif&lowPrecisionCoords=1",type:"Binary",id:"3a4x"},{ref:m}).then(a.Molecule.CreateFromData,{format:e.Core.Formats.Molecule.SupportedFormats.mmBCIF},{ref:"molecule",isBinding:true}).then(a.Molecule.CreateModel,{modelIndex:0});p.then(a.Molecule.CreateVisual,{style:c});p.then(a.Molecule.CreateSelectionFromQuery,{query:d,name:"Ligand",silent:true,inFullContext:true},{isBinding:true}).then(a.Molecule.CreateVisual,{style:u});return[4,t.applyTransform(p)];case 1:A.sent();s(false);f=t.createTransform().add("molecule",r.ValidatorDB.DownloadAndCreate,{reportRef:"validation"});h=t.applyTransform(f);v={server:"https://webchem.ncbr.muni.cz/DensityServer/",id:"3a4x",source:"X-ray",initialStreamingParams:{displayType:"Everything",showEverythingExtent:0}};B=t.createTransform().add("molecule",e.Extensions.DensityStreaming.Setup,v);t.applyTransform(B);return[4,h];case 2:A.sent();l();i(t,function(){return t.subscribe(e.Bootstrap.Command.Visual.ResetScene,function(){return setTimeout(function(){return l()},25)})},m,function(){return e.Bootstrap.Behaviour.Molecule.SuppressShowInteractionOnSelect=false});return[2]}})})}})(t=r.Examples||(r.Examples={}))})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){var t=e.Plugin.Views;var a=e.Bootstrap;var o=a.Entity.Transformer;var n=a.Components.LayoutRegion;r.PluginSpec={settings:{"molecule.model.defaultQuery":"residuesByName('GLY', 'ALA')","molecule.model.defaultAssemblyName":"1","molecule.coordinateStreaming.defaultId":"5iv5","molecule.coordinateStreaming.defaultServer":"https://webchem.ncbr.muni.cz/CoordinateServer","molecule.downloadBinaryCIFFromCoordinateServer.server":"https://webchem.ncbr.muni.cz/CoordinateServer","molecule.coordinateStreaming.defaultRadius":10,"density.defaultVisualBehaviourRadius":5,"extensions.densityStreaming.defaultServer":"https://webchem.ncbr.muni.cz/DensityServer/","extensions.rnaLoops.defaultServer":"http://rna.bgsu.edu/rna3dhub/loops/download/#id"},transforms:[{transformer:r.DataSources.ObtainMolecule,view:r.Views.ObtainDownload},{transformer:r.PDBe.Data.DownloadDensity,view:r.PDBe.Views.DownloadDensityView},{transformer:r.Examples.LoadExample,view:r.Views.LoadExample},{transformer:o.Molecule.CoordinateStreaming.InitStreaming,view:t.Transform.Molecule.InitCoordinateStreaming,initiallyCollapsed:true},{transformer:o.Data.Download,view:t.Transform.Data.Download,initiallyCollapsed:true},{transformer:o.Data.OpenFile,view:t.Transform.Data.OpenFile,initiallyCollapsed:true},{transformer:o.Molecule.CreateFromData,view:t.Transform.Molecule.CreateFromData},{transformer:o.Data.ParseCif,view:t.Transform.Empty},{transformer:o.Data.ParseBinaryCif,view:t.Transform.Empty},{transformer:o.Density.ParseData,view:t.Transform.Density.ParseData},{transformer:o.Molecule.CreateFromMmCif,view:t.Transform.Molecule.CreateFromMmCif},{transformer:o.Molecule.CreateModel,view:t.Transform.Molecule.CreateModel,initiallyCollapsed:true},{transformer:o.Molecule.CreateSelection,view:t.Transform.Molecule.CreateSelection,initiallyCollapsed:true},{transformer:o.Molecule.CreateAssembly,view:t.Transform.Molecule.CreateAssembly,initiallyCollapsed:true},{transformer:o.Molecule.CreateSymmetryMates,view:t.Transform.Molecule.CreateSymmetryMates,initiallyCollapsed:true},{transformer:o.Molecule.CreateMacromoleculeVisual,view:t.Transform.Empty},{transformer:o.Molecule.CreateVisual,view:t.Transform.Molecule.CreateVisual},{transformer:o.Molecule.CreateLabels,view:t.Transform.Molecule.CreateLabels},{transformer:e.Extensions.ParticleColoring.Apply,view:e.Extensions.ParticleColoring.UI.Apply,initiallyCollapsed:true},{transformer:e.Extensions.ComplexReprensetation.Carbohydrates.Transforms.CreateVisual,view:e.Extensions.ComplexReprensetation.Carbohydrates.UI.CreateVisual},{transformer:e.Extensions.ComplexReprensetation.Transforms.CreateComplexInfo,view:t.Transform.Empty},{transformer:e.Extensions.ComplexReprensetation.Transforms.CreateVisual,view:t.Transform.Empty},{transformer:o.Density.CreateFromCif,view:t.Transform.Molecule.CreateFromMmCif},{transformer:o.Density.CreateVisual,view:t.Transform.Density.CreateVisual},{transformer:o.Density.CreateVisualBehaviour,view:t.Transform.Density.CreateVisualBehaviour},{transformer:e.Extensions.DensityStreaming.Setup,view:e.Extensions.DensityStreaming.CreateView},{transformer:e.Extensions.DensityStreaming.CreateStreaming,view:e.Extensions.DensityStreaming.StreamingView},{transformer:o.Molecule.CoordinateStreaming.CreateBehaviour,view:t.Transform.Empty,initiallyCollapsed:true},{transformer:r.PDBe.Validation.DownloadAndCreate,view:t.Transform.Empty},{transformer:r.PDBe.Validation.ApplyTheme,view:t.Transform.Empty},{transformer:r.ValidatorDB.DownloadAndCreate,view:t.Transform.Empty},{transformer:r.ValidatorDB.ApplyTheme,view:t.Transform.Empty},{transformer:r.PDBe.SequenceAnnotation.DownloadAndCreate,view:t.Transform.Empty,initiallyCollapsed:true},{transformer:r.PDBe.SequenceAnnotation.CreateSingle,view:r.PDBe.Views.CreateSequenceAnnotationView,initiallyCollapsed:true},{transformer:e.Extensions.RNALoops.DownloadAndCreate,view:e.Extensions.RNALoops.CreateLoopAnnotationView,initiallyCollapsed:true},{transformer:e.Extensions.RNALoops.ApplyTheme,view:t.Transform.Empty,initiallyCollapsed:false}],behaviours:[a.Behaviour.SetEntityToCurrentWhenAdded,a.Behaviour.FocusCameraOnSelect,a.Behaviour.UnselectElementOnRepeatedClick,a.Behaviour.ApplySelectionToVisual,e.Extensions.ComplexReprensetation.Transforms.CreateRepresentationWhenModelIsAddedBehaviour,a.Behaviour.ApplyInteractivitySelection,a.Behaviour.Molecule.HighlightElementInfo,a.Behaviour.Molecule.DistanceToLastClickedElement,a.Behaviour.Molecule.ShowInteractionOnSelect(5),a.Behaviour.GoogleAnalytics("UA-77062725-1"),e.Extensions.ComplexReprensetation.Carbohydrates.HighlightCustomElementsBehaviour],components:[e.Plugin.Components.Visualization.HighlightInfo(n.Main,true),e.Plugin.Components.Entity.Current("LiteMol",e.Plugin.VERSION.number)(n.Right,true),e.Plugin.Components.Transform.View(n.Right),e.Plugin.Components.Context.Log(n.Bottom,true),e.Plugin.Components.Context.Overlay(n.Root),e.Plugin.Components.Context.Toast(n.Main,true),e.Plugin.Components.Context.BackgroundTasks(n.Main,true)],viewport:{view:t.Visualization.Viewport,controlsView:t.Visualization.ViewportControls},layoutView:t.Layout,tree:{region:n.Left,view:t.Entity.Tree}}})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var LiteMol;(function(e){var r;(function(r){function t(e,r){var t=new RegExp(e+"=("+r+")[&]?","i");return decodeURIComponent(((window.location.search||"").match(t)||[])[1]||"")}function a(a,o,n){if(n===void 0){n=false}var i=e.Plugin.create({customSpecification:r.PluginSpec,target:a,layoutState:o});i.context.logger.message("LiteMol Viewer "+r.VERSION.number);if(n)return i;var s=t("theme","[a-z]+").toLowerCase()||"light";if(s==="light"){i.setViewportBackground("#FCFBF9")}var l=t("loadFromPDB","[a-z0-9]+").toLowerCase().trim();if(l.length===4){var c=i.createTransform().add(i.root,r.PDBe.Data.DownloadMolecule,{id:l});i.applyTransform(c);return}var u=t("loadFromURL","[^&]+").trim();if(u){var m=e.Core.Formats.Molecule.SupportedFormats.mmCIF;switch(t("loadFromURLFormat","[a-z]+").toLocaleLowerCase().trim()){case"pdb":m=e.Core.Formats.Molecule.SupportedFormats.PDB;break;case"sdf":m=e.Core.Formats.Molecule.SupportedFormats.SDF;break;case"mmbcif":m=e.Core.Formats.Molecule.SupportedFormats.mmBCIF;break}var c=i.createTransform().add(i.root,r.DataSources.DownloadMolecule,{id:u,format:m});i.applyTransform(c)}var d=t("loadFromCS","[^&]+").trim();if(d&&d.length>=4&&d.length<=10){var c=i.createTransform().add(i.context.tree.root,r.PDBe.Data.DownloadBinaryCIFFromCoordinateServer,{id:d,type:"Full",lowPrecisionCoords:true,serverUrl:"https://webchem.ncbr.muni.cz/CoordinateServer"});i.applyTransform(c)}var p=r.Examples.ExampleMap[t("example","[a-z0-9-]+").toLowerCase().trim()];if(p)p.provider(i);return i}r.createInstance=a})(r=e.Viewer||(e.Viewer={}))})(LiteMol||(LiteMol={}));