<DOCTYPE html>
<html>
 <head>
  <link rel="stylesheet" href="../css/job.css">
 </head>
 <body>
	 
  <div class=header>
   Prime 3D Volume Refinement
  </div>
  
  <div class=jobinfo>
	<p>3D Volume refinement</p>
  </div>
  
	<div class=jobpane>
		<form id=jobform action='../JSONhandler'>
			<input type=hidden name=function value=simplejob>
			<input type=hidden name=program value=prime3D>
			<input type=hidden name=jobstatus value=starting>
			<input type=hidden name=jobtype value=prime3D>
			<input type=hidden name=jobpid value=0>
			<input type=hidden id=projecttable name=table value=0>
			<input type=hidden id=projectfolder name=jobfolder value=0>
			<input type=hidden name=stktab value=stkparts.txt>
			<input type=hidden name=oritab value=prime3D_in.txt>
			
			<table id=page1>
				<tr>
					<td colspan=2><b>Job Parameters</b></td>
				</tr>
				<tr>
					<td>Job Name</td>
					<td><input data-required=no type=text name=jobname placeholder="job identifier"></td>
				</tr>
				<tr data-required=no>
					<td>Job Description</td>
					<td><textarea data-required=no name=jobdescription placeholder="free text description of job"></textarea></td>
				</tr>
				<tr>
					<td colspan=2 style="text-align: center">
						<button type="button" onclick="document.getElementById('page1').style.display = 'none'; document.getElementById('page2').style.display = 'block'">Next</button>
					</td>
				</tr>
			</table>
			
			<table id=page2 style="display:none">
				<tr>
					<td colspan=2><b>Required Parameters</b></td>
				</tr>
				<tr>
					<td>Input File</td>
					<td><input data-required=no type=text name=simpleinput id=simpleinput placeholder="xxx.simple ptcls and params file" title="File containing particles and other parameters from earlier jobs (e.g. ini3D_particles.simple)"></td>
					<td><img src=../img/folder.png onclick="fileSelect(this)" data-target=simpleinput data-filter=".simple"></td>
				</tr>
				<tr>
					<td>Sampling Distance</td>
					<td><input data-required=no type=number step=0.001 name=smpd placeholder="pixel size in Angstroms" title="Size of detector pixels in Angstroms at magnification of data collection"></td>
					<td></td>
					<td>Point Group Symmetry of Object</td>
					<td><input data-required=no type=text name=pgrp placeholder="Point group symmetry of object" title="Point group symmetry of object { cn | dn | t | o | i } "></td>
				</tr>
					<td>Mask Radius </td>
					<td><input data-required=no type=number name=msk placeholder="mask radius in pixels" title="Radius of soft mask used during alignment and reconstruction in pixels"></td>
					<td></td>
					<td>CTF Correction</td>
					<td>
						<select data-required=no name=ctf title="Choose whether to perform full CTF correction, phase-flipping or no correction {yes = full correction}">
							<option value=yes selected>Yes</option>
							<option value=no>No</option>
							<option value=flip>Flip</option>
						</select>
					</td>
				<tr>
					<td colspan=5 style="text-align: center">
						<button type="button" onclick="document.getElementById('page2').style.display = 'none'; document.getElementById('page1').style.display = 'block'">Back</button>
						<button type="button" onclick="document.getElementById('page2').style.display = 'none'; document.getElementById('page3').style.display = 'block'">Next</button>
					</td>
				</tr>
			</table>
			
			<table id=page3 style="display:none">
				<tr>
					<td colspan=2><b>Optional Parameters</b></td>
				</tr>
				<tr>
					<td>Fractional Update Per Iteration</td>
					<td><input data-required=no type=number name=update_frac placeholder="fraction ptcls to update / iter {1.0}" title="Option to update only a pecentage of particles in each iteration to speed calculation (0-1) {1.0}" step="0.05"></td>
	  			<td></td>
					<td>Fraction of Particles to use</td>
					<td><input data-required=no type=number name=cenlp placeholder="fraction ptlcs used in reconstruction {1.0}" title="Use only the best fitting fraction of particles for reconstruction (0-1) {1.0}"></td>
				</tr>
				<tr>
				<td>Use Gold Standard FSC for Filtering and Resolution Setting?</td>
					<td>
						<select data-required=no name=eo title="Use gold standard FSC to determine resolution (yes|no) {yes}">
							<option value=yes selected>Yes</option>
							<option value=no>No</option>

						</select>
					</td> 
				<td></td>	
				<td>Volta Phaseplate Used?</td>
					<td>
						<select data-required=no name=phaseplate title="Was a Volta phaseplate used (yes | no) {no}">
							<option value=yes>Yes</option>
							<option value=no selected>No</option>
						</select>
					</td> 
				</tr>
				<tr>
				<td>Center particles / volume(s)</td>
					<td>
						<select data-required=no name=center title="Center particles / volume(s) ? (yes|no) {yes}">
							<option value=yes selected>Yes</option>
							<option value=no>No</option>

						</select>
					</td> 
					<td></td>
						<td>High resolution limit for centering</td>
					<td><input data-required=no type=number name=cenlp placeholder="high resolution limit for centering, Angstroms" title="High resolution limit for binarisation used for centering in Angstroms {30 A}"></td>
				</tr>
				<tr>
					<td>Refinement Mode</td>
					<td><input data-required=no type=text name=refine placeholder="refinement mode - commonly 'no' or 'neigh'" title="Orientation refinement mode {no} (no | yes | neigh | greedy | greedyneigh)"></td>
				<td></td>
					<td>Input Volume for Particle Alignment</td>
					<td><input data-required=no type=text name=vol1 placeholder="input volume e.g. volume.mrc" title="Input volume for alignment (e.g. xxx.mrc, xxx.spi)"></td>
				</tr>
				<tr>
					<td>Maximum Translational Shift</td>
					<td><input data-required=no type=number name=trs placeholder="Translational shift per iteration, pixels" title="Maximum translational shift per iteration in pixels"></td>
				<td></td>
					<td>Number of Projections</td>
					<td><input data-required=no type=number name=nspace placeholder="# of projections used" title="Number of projections used"></					</td>
				</tr>
				<tr>
					<td>Low Resolution Limit</td>
					<td><input data-required=no type=number name=hp placeholder="low resolution limit, Angstroms" title="Low resolution limit in Angstroms"></td>
				<td></td>
					<td>High Resolution limit</td>
					<td><input data-required=no type=number name=lp placeholder="high resolution limit, Angstroms" title="High resolution limint in Angstroms"></					</td>
				</tr>
				<tr>
					<td>Inner Mask Radius</td>
					<td><input data-required=no type=number name=inner placeholder="inner mask radius, pixels" title="Define an innner spherical mask - radius in pixels"></td>
				<td></td>
					<td>Inner Mask Falloff Rate</td>
					<td><input data-required=no type=number name=width placeholder="falloff of inner mask, pixels" title="Falloff of inner mask / filter in pixels {10}"></					</td>
				</tr>
				<tr>
					<td>Input Mask File</td>
					<td><input data-required=no type=text id=mskfile name=mskfile placeholder="e.g. automask.mrc from postprocessing" title=".mrc file for mask generated using postprocessing"></td>
					<td><img src=../img/folder.png onclick="fileSelect(this)" data-target=mskfile data-filter=".mrc"></td>
				</tr>

				<tr> <td><br></td>
				</tr>
				<tr> 
					<td><b>Additional Parameters</b></td>
				</tr>
				<tr> 
					<td></td>
					<td><input data-required=no type=text id=additionalparams placeholder="additional parameters param=value param2=value2..." title="Additional Parameters entered in format param=value"></td>
					<td></td>
				</tr>
			<tr>
					<td colspan=5 style="text-align: center">
						<button type="button" onclick="document.getElementById('page3').style.display = 'none'; document.getElementById('page2').style.display = 'block'">Back</button>
						<button type="button" onclick="document.getElementById('page3').style.display = 'none'; document.getElementById('page4').style.display = 'block'">Next</button>
					</td>
				</tr>
			</table>
			
			<table id=page4 style="display:none">
				<tr>
					<td colspan=2><b>Run Parameters</b></td>
					<input type=hidden name=executable value=simple_distr_exec>
				</tr>
				<tr>
					<td>Number Parts</td>
					<td><input data-required=no type=number name=nparts placeholder="divide job into # parts" title="Number of parts to divide distributed job into for processing {1}"></td>
					<td>Number Threads per Part</td>
					<td><input data-required=no type=number name=nthr placeholder="# shared-memory CPU threads" title="Number of shared-memory CPU threads available {1}"></td>
				</tr>
					
				<tr>
					<td>Number of Compute Units</td>
					<td>
						<input type=number type=number name=ncunits placeholder="# independent computing units" title="Number of separate computing units available, should be >= number of parts {1}">
					</td>
					<td>Submit to Queue</td>
					<td>
						<select data-required=no name=queue_submit onchange="showHideQueueOptions()">
							<option value=yes>Yes</option>
							<option value=no selected>No</option>
						</select>
					</td>
				</tr>
					
				<tr data-queue=yes>
					<td>Maximum Job Time</td>
					<td>
						<input data-required=no type=number name=time_per_image placeholder="time allowed in queue per job (s)" title="Maximum time allowed in queue per job in seconds">
					</td>
				</tr>
				
				<tr data-queue=yes>
					<td>Memory Per Job</td>
					<td>
						<input data-required=no type=number name=job_memory_per_task placeholder="memory allocated per job (bytes)" title="Memory allocated per job in bytes" >
					</td>
					<td >Queue Partition</td>
					<td>
						<input data-required=no type=text name=qsys_partition placeholder="queue name" title="Name of queue to submit distributed jobs to">
					</td>
				</tr>
				
				<tr data-queue=yes>
					<td>Number Tasks Per Socket</td>
					<td>
						<input data-required=no type=number name=job_ntasks_per_socket placeholder="# jobs per CPU socket" title="Number of simultaneous jobs to run on each CPU socket">
					</td>
					<td >Job Identifier</td>
					<td>
						<input data-required=no type=text name=job_name placeholder="queue job name" title="Assign a job name to the submitted jobs">
					</td>
				</tr>
				
				<tr data-queue=yes>
					<td>Queue QOS</td>
					<td>
						<input data-required=no type=text name=qsys_qos>
					</td>
					<td >Submit Master to Queue</td>
					<td>
						<select data-required=no name=submitmaster title="Choose whether master process runs on queue or locally">
							<option value=yes>Yes</option>
							<option value=no selected>No</option>
						</select>
					</td>
				<tr>
					<td colspan=4 style="text-align: center">
						<button type="button" onclick="document.getElementById('page4').style.display = 'none'; document.getElementById('page3').style.display = 'block'">Back</button>
						<button type="button" onclick="document.getElementById('page4').style.display = 'none'; runJob(this)">Run</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
	
	<div id=gauze class=gauze></div>
	
	<div class=selectfilepopup id=selectfilepopup>
	 <div class=header id=selectfileheader>
		<img class=simpleicon id=simpleicon src=../img/simple_favicon.ico>
		File Browser
		<img src=../img/close.png class=closeimage onclick='hideFileSelect()'>
	</div>
	 <div class=mainpane>
		 <input type=hidden id=filetarget>
		 <input type=hidden id=filefilter>
		<input class=selectfiledirectory id=selectfiledirectory>
		<div class=selectfiletable>
			<table id=selectfiletable></table>
		</div>
	</div>
	<button class=selectfilebutton onclick='hideFileSelect()'>Select</button>
   </div> 
	
  <script src="../js/job.js"></script>
    <script>setReRun()</script>
  <script>setProjectTable()</script>
  <script>setProjectFolder()</script>
 </body>
</html>
