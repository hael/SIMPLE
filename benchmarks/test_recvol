#!/bin/bash
## SIMPLE_TESTBENCH
if [ -z "${SIMPLE_TESTBENCH_DATA+set}" ]; then
   echo "SIMPLE_TESTBENCH_DATA env variable is not set."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}" ]; then
    echo "SIMPLE_TESTBENCH_DATA variable is not a directory."; exit 1
fi

if [ ! -d "${SIMPLE_TESTBENCH_DATA}/recvol_1wcm" ]; then
    echo "recvol_1wcm is not a directory in the benchmark data folder."; exit 1
fi
cd ${SIMPLE_TESTBENCH_DATA}/recvol_1wcm

echo " ## Expected Output: 10 core, Intel Xeon E5-2650, Compiled with GNU_RELEASE_FFTW  "
echo " ## >>> DONE PROCESSING PARAMETERS                                                "
echo " ## >>> DONE BUILDING GENERAL TOOLBOX                                             "
echo " ## >>> DONE BUILDING RECONSTRUCTION TOOLBOX                                      "
echo " ## >>> KAISER-BESSEL INTERPOLATION                                               "
echo " ## Percent Complete:  100%                                                       "
echo " ## >>> SAMPLING DENSITY (RHO) CORRECTION & WIENER NORMALIZATION                  "
echo " ## GENERATED VOLUMES: recvol*.ext                                                "
echo " ## **** SIMPLE_RECVOL NORMAL STOP ****                                           "
echo " ##                                                                               "
echo " ## real 0m3.263s                                                                 "
echo " ## user 0m47.543s                                                                "
echo " ## sys 0m0.345s                                                                  "
echo "                                                                                  "
[ -f recvol_state01.mrc ] &&  rm -f recvol_state01.mrc
time simple_exec prg=recvol ctf=no msk=50 oritab=projvol_oris.txt pgrp=c1 smpd=2 stk=projs.mrc

echo " ## >>> TESTING AGAINST REFERENCE IMAGE                                           "
#[ -f recvol_diff.mrc ] &&  rm -f recvol_diff.mrc
#simple_exec prg=image_diff stk=recvol_state01.mrc stk2=reference/recvol_state01.mrc outstk=recvol_diff.mrc
chimera recvol_state01.mrc reference/recvol_state01.mrc
